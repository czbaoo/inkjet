/*
 * inkjet - Image processor
 * @version v1.0.0
 * @author Grigoriy Chudnov <g.chudnov@gmail.com> (https://github.com/gchudnov)
 * @link https://github.com/gchudnov/inkjet
 * @license MIT
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.inkjet=e()}}(function(){return function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var f=r[o]={exports:{}};t[o][0].call(f.exports,function(e){var r=t[o][1][e];return i(r?r:e)},f,f.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t){"use strict";function r(t,r,n){if("function"==typeof r&&(n=r,r={}),t instanceof ArrayBuffer&&(t=new Uint8Array(t,0)),a){var i=e("webworkify")(f);i.onmessage=function(e){var t=e.data,r=t.err?new Error(t.err):void 0;n(r,t.result)};var o={buf:t};r.transferable?i.postMessage(o,[t]):i.postMessage(o)}else s(t,r,n)}function n(e,t,r){"function"==typeof t&&(r=t,t={}),"number"==typeof t&&(t={quality:t}),a=!1,a||c(e,t,r)}function i(t,r,n){if("function"==typeof r&&(n=r,r={}),a){var i=e("webworkify")(u);i.onmessage=function(e){var t=e.data,r=t.err?new Error(t.err):void 0;n(r,t.result)};var s={buf:t};r.transferable?i.postMessage(s,[t]):i.postMessage(s)}else o(t,r,n)}{var a=e("./lib/has-worker").HAS_WORKER,o=e("./lib/exif"),s=e("./lib/decode"),c=e("./lib/encode"),u=e("./lib/exif-worker"),f=e("./lib/decode-worker");e("./lib/encode-worker")}t.exports.decode=r,t.exports.encode=n,t.exports.exif=i},{"./lib/decode":6,"./lib/decode-worker":5,"./lib/encode":8,"./lib/encode-worker":7,"./lib/exif":10,"./lib/exif-worker":9,"./lib/has-worker":11,webworkify:12}],2:[function(e,t,r){(function(){("undefined"!=typeof r&&null!==r?r:this).ExifReader=function(){function e(){var e=this;this._getTagValueAt={1:function(t){return e._getByteAt(t)},2:function(t){return e._getAsciiAt(t)},3:function(t){return e._getShortAt(t)},4:function(t){return e._getLongAt(t)},5:function(t){return e._getRationalAt(t)},7:function(t){return e._getUndefinedAt(t)},9:function(t){return e._getSlongAt(t)},10:function(t){return e._getSrationalAt(t)}},this._tiffHeaderOffset=0}return e.prototype._MIN_DATA_BUFFER_LENGTH=2,e.prototype._JPEG_ID_SIZE=2,e.prototype._JPEG_ID=65496,e.prototype._APP_MARKER_SIZE=2,e.prototype._APP0_MARKER=65504,e.prototype._APP1_MARKER=65505,e.prototype._APP15_MARKER=65519,e.prototype._APP_ID_OFFSET=4,e.prototype._BYTES_Exif=1165519206,e.prototype._TIFF_HEADER_OFFSET=10,e.prototype._BYTE_ORDER_BIG_ENDIAN=18761,e.prototype._BYTE_ORDER_LITTLE_ENDIAN=19789,e.prototype.load=function(e){return this.loadView(new DataView(e))},e.prototype.loadView=function(e){return this._dataView=e,this._tags={},this._checkImageHeader(),this._readTags(),this._dataView=null},e.prototype._checkImageHeader=function(){if(this._dataView.byteLength<this._MIN_DATA_BUFFER_LENGTH||this._dataView.getUint16(0,!1)!==this._JPEG_ID)throw new Error("Invalid image format");if(this._parseAppMarkers(this._dataView),!this._hasExifData())throw new Error("No Exif data")},e.prototype._parseAppMarkers=function(e){var t,r,n;for(t=this._JPEG_ID_SIZE,n=[];;){if(e.byteLength<t+this._APP_ID_OFFSET+5)break;if(this._isApp1ExifMarker(e,t))r=e.getUint16(t+this._APP_MARKER_SIZE,!1),this._tiffHeaderOffset=t+this._TIFF_HEADER_OFFSET;else{if(!this._isAppMarker(e,t))break;r=e.getUint16(t+this._APP_MARKER_SIZE,!1)}n.push(t+=this._APP_MARKER_SIZE+r)}return n},e.prototype._isApp1ExifMarker=function(e,t){return e.getUint16(t,!1)===this._APP1_MARKER&&e.getUint32(t+this._APP_ID_OFFSET,!1)===this._BYTES_Exif&&0===e.getUint8(t+this._APP_ID_OFFSET+4,!1)},e.prototype._isAppMarker=function(e,t){var r;return r=e.getUint16(t,!1),r>=this._APP0_MARKER&&r<=this._APP15_MARKER},e.prototype._hasExifData=function(){return 0!==this._tiffHeaderOffset},e.prototype._readTags=function(){return this._setByteOrder(),this._read0thIfd(),this._readExifIfd(),this._readGpsIfd(),this._readInteroperabilityIfd()},e.prototype._setByteOrder=function(){if(this._dataView.getUint16(this._tiffHeaderOffset)===this._BYTE_ORDER_BIG_ENDIAN)return this._littleEndian=!0;if(this._dataView.getUint16(this._tiffHeaderOffset)===this._BYTE_ORDER_LITTLE_ENDIAN)return this._littleEndian=!1;throw new Error("Illegal byte order value. Faulty image.")},e.prototype._read0thIfd=function(){var e;return e=this._getIfdOffset(),this._readIfd("0th",e)},e.prototype._getIfdOffset=function(){return this._tiffHeaderOffset+this._getLongAt(this._tiffHeaderOffset+4)},e.prototype._readExifIfd=function(){var e;return null!=this._tags["Exif IFD Pointer"]?(e=this._tiffHeaderOffset+this._tags["Exif IFD Pointer"].value,this._readIfd("exif",e)):void 0},e.prototype._readGpsIfd=function(){var e;return null!=this._tags["GPS Info IFD Pointer"]?(e=this._tiffHeaderOffset+this._tags["GPS Info IFD Pointer"].value,this._readIfd("gps",e)):void 0},e.prototype._readInteroperabilityIfd=function(){var e;return null!=this._tags["Interoperability IFD Pointer"]?(e=this._tiffHeaderOffset+this._tags["Interoperability IFD Pointer"].value,this._readIfd("interoperability",e)):void 0},e.prototype._readIfd=function(e,t){var r,n,i,a,o;for(n=this._getShortAt(t),t+=2,o=[],r=a=0;n>=0?n>a:a>n;r=n>=0?++a:--a)i=this._readTag(e,t),void 0!==i&&(this._tags[i.name]={value:i.value,description:i.description}),o.push(t+=12);return o},e.prototype._readTag=function(e,t){var r,n,i,a,o,s,c;return r=this._getShortAt(t),o=this._getShortAt(t+2),n=this._getLongAt(t+4),void 0===this._typeSizes[o]?void 0:(this._typeSizes[o]*n<=4?s=this._getTagValue(t+8,o,n):(c=this._getLongAt(t+8),s=this._getTagValue(this._tiffHeaderOffset+c,o,n)),o===this._tagTypes.ASCII&&(s=this._splitNullSeparatedAsciiString(s)),null!=this._tagNames[e][r]?(null!=this._tagNames[e][r].name&&null!=this._tagNames[e][r].description?(a=this._tagNames[e][r].name,i=this._tagNames[e][r].description(s)):(a=this._tagNames[e][r],i=s instanceof Array?s.join(", "):s),{name:a,value:s,description:i}):{name:"undefined-"+r,value:s,description:s})},e.prototype._getTagValue=function(e,t,r){var n,i,a;return i=function(){var i,o;for(o=[],a=i=0;r>=0?r>i:i>r;a=r>=0?++i:--i)n=this._getTagValueAt[t](e),e+=this._typeSizes[t],o.push(n);return o}.call(this),1===i.length?i=i[0]:t===this._tagTypes.ASCII&&(i=this._getAsciiValue(i)),i},e.prototype._getAsciiValue=function(e){var t,r;return r=function(){var r,n,i;for(i=[],r=0,n=e.length;n>r;r++)t=e[r],i.push(String.fromCharCode(t));return i}()},e.prototype._getByteAt=function(e){return this._dataView.getUint8(e)},e.prototype._getAsciiAt=function(e){return this._dataView.getUint8(e)},e.prototype._getShortAt=function(e){return this._dataView.getUint16(e,this._littleEndian)},e.prototype._getLongAt=function(e){return this._dataView.getUint32(e,this._littleEndian)},e.prototype._getRationalAt=function(e){return this._getLongAt(e)/this._getLongAt(e+4)},e.prototype._getUndefinedAt=function(e){return this._getByteAt(e)},e.prototype._getSlongAt=function(e){return this._dataView.getInt32(e,this._littleEndian)},e.prototype._getSrationalAt=function(e){return this._getSlongAt(e)/this._getSlongAt(e+4)},e.prototype._splitNullSeparatedAsciiString=function(e){var t,r,n,i,a;for(n=[],r=0,i=0,a=e.length;a>i;i++)t=e[i],"\x00"!==t?(null==n[r]&&(n[r]=""),n[r]+=t):r++;return n},e.prototype._typeSizes={1:1,2:1,3:2,4:4,5:8,7:1,9:4,10:8},e.prototype._tagTypes={BYTE:1,ASCII:2,SHORT:3,LONG:4,RATIONAL:5,UNDEFINED:7,SLONG:9,SRATIONAL:10},e.prototype._tagNames={"0th":{256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:{name:"Orientation",description:function(e){switch(e){case 1:return"top-left";case 2:return"top-right";case 3:return"bottom-right";case 4:return"bottom-left";case 5:return"left-top";case 6:return"right-top";case 7:return"right-bottom";case 8:return"left-bottom";default:return"Undefined"}}},277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:{name:"ResolutionUnit",description:function(e){switch(e){case 2:return"inches";case 3:return"centimeters";default:return"Unknown"}}},301:"TransferFunction",305:"Software",306:"DateTime",315:"Artist",318:"WhitePoint",319:"PrimaryChromaticities",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:{name:"YCbCrPositioning",description:function(e){switch(e){case 1:return"centered";case 2:return"co-sited";default:return"undefied "+e}}},532:"ReferenceBlackWhite",33432:{name:"Copyright",description:function(e){return e.join("; ")}},34665:"Exif IFD Pointer",34853:"GPS Info IFD Pointer"},exif:{33434:"ExposureTime",33437:"FNumber",34850:{name:"ExposureProgram",description:function(e){switch(e){case 0:return"Undefined";case 1:return"Manual";case 2:return"Normal program";case 3:return"Aperture priority";case 4:return"Shutter priority";case 5:return"Creative program";case 6:return"Action program";case 7:return"Portrait mode";case 8:return"Landscape mode";default:return"Unknown"}}},34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:{name:"OECF",description:function(){return"[Raw OECF table data]"}},36864:{name:"ExifVersion",description:function(e){var t,r,n,i;for(r="",n=0,i=e.length;i>n;n++)t=e[n],r+=String.fromCharCode(t);return r}},36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:{name:"ComponentsConfiguration",description:function(e){var t,r,n,i;for(r="",n=0,i=e.length;i>n;n++)switch(t=e[n]){case 49:r+="Y";break;case 50:r+="Cb";break;case 51:r+="Cr";break;case 52:r+="R";break;case 53:r+="G";break;case 54:r+="B"}return r}},37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:{name:"MeteringMode",description:function(e){switch(e){case 1:return"Average";case 2:return"CenterWeightedAverage";case 3:return"Spot";case 4:return"MultiSpot";case 5:return"Pattern";case 6:return"Partial";case 255:return"Other";default:return"Unknown"}}},37384:{name:"LightSource",description:function(e){switch(e){case 1:return"Daylight";case 2:return"Fluorescent";case 3:return"Tungsten (incandescent light)";case 4:return"Flash";case 9:return"Fine weather";case 10:return"Cloudy weather";case 11:return"Shade";case 12:return"Daylight fluorescent (D 5700 – 7100K)";case 13:return"Day white fluorescent (N 4600 – 5400K)";case 14:return"Cool white fluorescent (W 3900 – 4500K)";case 15:return"White fluorescent (WW 3200 – 3700K)";case 17:return"Standard light A";case 18:return"Standard light B";case 19:return"Standard light C";case 20:return"D55";case 21:return"D65";case 22:return"D75";case 23:return"D50";case 24:return"ISO studio tungsten";case 255:return"Other light source";default:return"Unknown"}}},37385:{name:"Flash",description:function(e){switch(e){case 0:return"Flash did not fire";case 1:return"Flash fired";case 5:return"Strobe return light not detected";case 7:return"Strobe return light detected";case 9:return"Flash fired, compulsory flash mode";case 13:return"Flash fired, compulsory flash mode, return light not detected";case 15:return"Flash fired, compulsory flash mode, return light detected";case 16:return"Flash did not fire, compulsory flash mode";case 24:return"Flash did not fire, auto mode";case 25:return"Flash fired, auto mode";case 29:return"Flash fired, auto mode, return light not detected";case 31:return"Flash fired, auto mode, return light detected";case 32:return"No flash function";case 65:return"Flash fired, red-eye reduction mode";case 69:return"Flash fired, red-eye reduction mode, return light not detected";case 71:return"Flash fired, red-eye reduction mode, return light detected";case 73:return"Flash fired, compulsory flash mode, red-eye reduction mode";case 77:return"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected";case 79:return"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected";case 89:return"Flash fired, auto mode, red-eye reduction mode";case 93:return"Flash fired, auto mode, return light not detected, red-eye reduction mode";case 95:return"Flash fired, auto mode, return light detected, red-eye reduction mode";default:return"Unknown"}}},37386:"FocalLength",37396:{name:"SubjectArea",description:function(e){switch(e.length){case 2:return"Location; X: "+e[0]+", Y: "+e[1];case 3:return"Circle; X: "+e[0]+", Y: "+e[1]+", diameter: "+e[2];case 4:return"Rectangle; X: "+e[0]+", Y: "+e[1]+", width: "+e[2]+", height: "+e[3];default:return"Unknown"}}},37500:{name:"MakerNote",description:function(){return"[Raw maker note data]"}},37510:{name:"UserComment",description:function(e){switch(e.slice(0,8).map(function(e){return String.fromCharCode(e)}).join("")){case"ASCII\x00\x00\x00":return e.slice(8,e.length).map(function(e){return String.fromCharCode(e)}).join("");case"JIS\x00\x00\x00\x00\x00":return"[JIS encoded text]";case"UNICODE\x00":return"[Unicode encoded text]";case"\x00\x00\x00\x00\x00\x00\x00\x00":return"[Undefined encoding]"}}},37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",40960:{name:"FlashpixVersion",description:function(e){var t,r,n,i;for(r="",n=0,i=e.length;i>n;n++)t=e[n],r+=String.fromCharCode(t);return r}},40961:{name:"ColorSpace",description:function(e){switch(e){case 1:return"sRGB";case 65535:return"Uncalibrated";default:return"Unknown"}}},40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",40965:"Interoperability IFD Pointer",41483:"FlashEnergy",41484:{name:"SpatialFrequencyResponse",description:function(){return"[Raw SFR table data]"}},41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:{name:"FocalPlaneResolutionUnit",description:function(e){switch(e){case 2:return"inches";case 3:return"centimeters";default:return"Unknown"}}},41492:{name:"SubjectLocation",description:function(e){return"X: "+e[0]+", Y: "+e[1]}},41493:"ExposureIndex",41495:{name:"SensingMethod",description:function(e){switch(e){case 1:return"Undefined";case 2:return"One-chip color area sensor";case 3:return"Two-chip color area sensor";case 4:return"Three-chip color area sensor";case 5:return"Color sequential area sensor";case 7:return"Trilinear sensor";case 8:return"Color sequential linear sensor";default:return"Unknown"}}},41728:{name:"FileSource",description:function(e){switch(e){case 3:return"DSC";default:return"Unknown"}}},41729:{name:"SceneType",description:function(e){switch(e){case 1:return"A directly photographed image";default:return"Unknown"}}},41730:{name:"CFAPattern",description:function(){return"[Raw CFA pattern table data]"}},41985:{name:"CustomRendered",description:function(e){switch(e){case 0:return"Normal process";case 1:return"Custom process";default:return"Unknown"}}},41986:{name:"ExposureMode",description:function(e){switch(e){case 0:return"Auto exposure";case 1:return"Manual exposure";case 2:return"Auto bracket";default:return"Unknown"}}},41987:{name:"WhiteBalance",description:function(e){switch(e){case 0:return"Auto white balance";case 1:return"Manual white balance";default:return"Unknown"}}},41988:{name:"DigitalZoomRatio",description:function(e){switch(e){case 0:return"Digital zoom was not used";default:return e}}},41989:{name:"FocalLengthIn35mmFilm",description:function(e){switch(e){case 0:return"Unknown";default:return e}}},41990:{name:"SceneCaptureType",description:function(e){switch(e){case 0:return"Standard";case 1:return"Landscape";case 2:return"Portrait";case 3:return"Night scene";default:return"Unknown"}}},41991:{name:"GainControl",description:function(e){switch(e){case 0:return"None";case 1:return"Low gain up";case 2:return"High gain up";case 3:return"Low gain down";case 4:return"High gain down";default:return"Unknown"}}},41992:{name:"Contrast",description:function(e){switch(e){case 0:return"Normal";case 1:return"Soft";case 2:return"Hard";default:return"Unknown"}}},41993:{name:"Saturation",description:function(e){switch(e){case 0:return"Normal";case 1:return"Low saturation";case 2:return"High saturation";default:return"Unknown"}}},41994:{name:"Sharpness",description:function(e){switch(e){case 0:return"Normal";case 1:return"Soft";case 2:return"Hard";default:return"Unknown"}}},41995:{name:"DeviceSettingDescription",description:function(){return"[Raw device settings table data]"}},41996:{name:"SubjectDistanceRange",description:function(e){switch(e){case 1:return"Macro";case 2:return"Close view";case 3:return"Distant view";default:return"Unknown"}}},42016:"ImageUniqueID"},gps:{0:{name:"GPSVersionID",description:function(e){var t,r;return e[0]===(t=e[1])&&2===t&&e[2]===(r=e[3])&&0===r?"Version 2.2":"Unknown"}},1:{name:"GPSLatitudeRef",description:function(e){switch(e.join("")){case"N":return"North latitude";case"S":return"South latitude";default:return"Unknown"}}},2:{name:"GPSLatitude",description:function(e){return e[0]+e[1]/60+e[2]/3600}},3:{name:"GPSLongitudeRef",description:function(e){switch(e.join("")){case"E":return"East longitude";case"W":return"West longitude";default:return"Unknown"}}},4:{name:"GPSLongitude",description:function(e){return e[0]+e[1]/60+e[2]/3600}},5:{name:"GPSAltitudeRef",description:function(e){switch(e){case 0:return"Sea level";case 1:return"Sea level reference (negative value)";default:return"Unknown"}}},6:{name:"GPSAltitude",description:function(e){return e+" m"}},7:{name:"GPSTimeStamp",description:function(e){var t;return t=function(e){var t;return function(){var r,n,i;for(i=[],t=r=0,n=2-(""+Math.floor(e)).length;n>=0?n>r:r>n;t=n>=0?++r:--r)i.push("0");return i}()+e},e.map(t).join(":")}},8:"GPSSatellites",9:{name:"GPSStatus",description:function(e){switch(e.join("")){case"A":return"Measurement in progress";case"V":return"Measurement Interoperability";default:return"Unknown"}}},10:{name:"GPSMeasureMode",description:function(e){switch(e.join("")){case"2":return"2-dimensional measurement";case"3":return"3-dimensional measurement";default:return"Unknown"}}},11:"GPSDOP",12:{name:"GPSSpeedRef",description:function(e){switch(e.join("")){case"K":return"Kilometers per hour";case"M":return"Miles per hour";case"N":return"Knots";default:return"Unknown"}}},13:"GPSSpeed",14:{name:"GPSTrackRef",description:function(e){switch(e.join("")){case"T":return"True direction";case"M":return"Magnetic direction";default:return"Unknown"}}},15:"GPSTrack",16:{name:"GPSImgDirectionRef",description:function(e){switch(e.join("")){case"T":return"True direction";case"M":return"Magnetic direction";default:return"Unknown"}}},17:"GPSImgDirection",18:"GPSMapDatum",19:{name:"GPSDestLatitudeRef",description:function(e){switch(e.join("")){case"N":return"North latitude";case"S":return"South latitude";default:return"Unknown"}}},20:{name:"GPSDestLatitude",description:function(e){return e[0]+e[1]/60+e[2]/3600}},21:{name:"GPSDestLongitudeRef",description:function(e){switch(e.join("")){case"E":return"East longitude";case"W":return"West longitude";default:return"Unknown"}}},22:{name:"GPSDestLongitude",description:function(e){return e[0]+e[1]/60+e[2]/3600}},23:{name:"GPSDestBearingRef",description:function(e){switch(e.join("")){case"T":return"True direction";case"M":return"Magnetic direction";default:return"Unknown"}}},24:"GPSDestBearing",25:{name:"GPSDestDistanceRef",description:function(e){switch(e.join("")){case"K":return"Kilometers";case"M":return"Miles";case"N":return"Knots";default:return"Unknown"}}},26:"GPSDestDistance",27:{name:"GPSProcessingMethod",description:function(e){if(0===e)return"Undefined";switch(e.slice(0,8).map(function(e){return String.fromCharCode(e)}).join("")){case"ASCII\x00\x00\x00":return e.slice(8,e.length).map(function(e){return String.fromCharCode(e)}).join("");case"JIS\x00\x00\x00\x00\x00":return"[JIS encoded text]";case"UNICODE\x00":return"[Unicode encoded text]";case"\x00\x00\x00\x00\x00\x00\x00\x00":return"[Undefined encoding]"}}},28:{name:"GPSAreaInformation",description:function(e){if(0===e)return"Undefined";switch(e.slice(0,8).map(function(e){return String.fromCharCode(e)}).join("")){case"ASCII\x00\x00\x00":return e.slice(8,e.length).map(function(e){return String.fromCharCode(e)}).join("");case"JIS\x00\x00\x00\x00\x00":return"[JIS encoded text]";case"UNICODE\x00":return"[Unicode encoded text]";case"\x00\x00\x00\x00\x00\x00\x00\x00":return"[Undefined encoding]"}}},29:"GPSDateStamp",30:{name:"GPSDifferential",description:function(e){switch(e){case 0:return"Measurement without differential correction";case 1:return"Differential correction applied";default:return"Unknown"}}}},interoperability:{1:"InteroperabilityIndex",2:"UnknownInteroperabilityTag0x0002",4097:"UnknownInteroperabilityTag0x1001",4098:"UnknownInteroperabilityTag0x1002"}},e.prototype.getTagValue=function(e){return null!=this._tags[e]?this._tags[e].value:void 0},e.prototype.getTagDescription=function(e){return null!=this._tags[e]?this._tags[e].description:void 0},e.prototype.getAllTags=function(){return this._tags},e.prototype.deleteTag=function(e){return delete this._tags[e]},e}()}).call(this)},{}],3:[function(e,t){function r(e){function t(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;64>r;r++){var n=_((t[r]*e+50)/100);1>n?n=1:n>255&&(n=255),I[G[r]]=n}for(var i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;64>a;a++){var o=_((i[a]*e+50)/100);1>o?o=1:o>255&&(o=255),k[G[a]]=o}for(var s=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],c=0,u=0;8>u;u++)for(var f=0;8>f;f++)C[c]=1/(I[G[c]]*s[u]*s[f]*8),A[c]=1/(k[G[c]]*s[u]*s[f]*8),c++}function r(e,t){for(var r=0,n=0,i=new Array,a=1;16>=a;a++){for(var o=1;o<=e[a];o++)i[t[n]]=[],i[t[n]][0]=r,i[t[n]][1]=a,n++,r++;r*=2}return i}function n(){b=r(q,H),w=r(V,j),x=r(J,X),S=r(Y,W)}function i(){for(var e=1,t=2,r=1;15>=r;r++){for(var n=e;t>n;n++)D[32767+n]=r,M[32767+n]=[],M[32767+n][1]=r,M[32767+n][0]=n;for(var i=-(t-1);-e>=i;i++)D[32767+i]=r,M[32767+i]=[],M[32767+i][1]=r,M[32767+i][0]=t-1+i;e<<=1,t<<=1}}function a(){for(var e=0;256>e;e++)N[e]=19595*e,N[e+256>>0]=38470*e,N[e+512>>0]=7471*e+32768,N[e+768>>0]=-11059*e,N[e+1024>>0]=-21709*e,N[e+1280>>0]=32768*e+8421375,N[e+1536>>0]=-27439*e,N[e+1792>>0]=-5329*e}function o(e){for(var t=e[0],r=e[1]-1;r>=0;)t&1<<r&&(R|=1<<U),r--,U--,0>U&&(255==R?(s(255),s(0)):s(R),U=7,R=0)}function s(e){F.push(e)}function c(e){s(e>>8&255),s(255&e)}function u(e,t){var r,n,i,a,o,s,c,u,f,l=0;const h=8,d=64;for(f=0;h>f;++f){r=e[l],n=e[l+1],i=e[l+2],a=e[l+3],o=e[l+4],s=e[l+5],c=e[l+6],u=e[l+7];var p=r+u,m=r-u,g=n+c,v=n-c,y=i+s,b=i-s,w=a+o,x=a-o,S=p+w,P=p-w,_=g+y,I=g-y;e[l]=S+_,e[l+4]=S-_;var k=.707106781*(I+P);e[l+2]=P+k,e[l+6]=P-k,S=x+b,_=b+v,I=v+m;var C=.382683433*(S-I),A=.5411961*S+C,M=1.306562965*I+C,D=.707106781*_,E=m+D,F=m-D;e[l+5]=F+A,e[l+3]=F-A,e[l+1]=E+M,e[l+7]=E-M,l+=8}for(l=0,f=0;h>f;++f){r=e[l],n=e[l+8],i=e[l+16],a=e[l+24],o=e[l+32],s=e[l+40],c=e[l+48],u=e[l+56];var R=r+u,U=r-u,O=n+c,L=n-c,B=i+s,z=i-s,N=a+o,G=a-o,q=R+N,H=R-N,J=O+B,X=O-B;e[l]=q+J,e[l+32]=q-J;var V=.707106781*(X+H);e[l+16]=H+V,e[l+48]=H-V,q=G+z,J=z+L,X=L+U;var j=.382683433*(q-X),Y=.5411961*q+j,W=1.306562965*X+j,Z=.707106781*J,K=U+Z,Q=U-Z;e[l+40]=Q+Y,e[l+24]=Q-Y,e[l+8]=K+W,e[l+56]=K-W,l++}var $;for(f=0;d>f;++f)$=e[f]*t[f],T[f]=$>0?$+.5|0:$-.5|0;return T}function f(){c(65504),c(16),s(74),s(70),s(73),s(70),s(0),s(1),s(1),s(0),c(1),c(1),s(0),s(0)}function l(e,t){c(65472),c(17),s(8),c(t),c(e),s(3),s(1),s(17),s(0),s(2),s(17),s(1),s(3),s(17),s(1)}function h(){c(65499),c(132),s(0);for(var e=0;64>e;e++)s(I[e]);s(1);for(var t=0;64>t;t++)s(k[t])}function d(){c(65476),c(418),s(0);for(var e=0;16>e;e++)s(q[e+1]);for(var t=0;11>=t;t++)s(H[t]);s(16);for(var r=0;16>r;r++)s(J[r+1]);for(var n=0;161>=n;n++)s(X[n]);s(1);for(var i=0;16>i;i++)s(V[i+1]);for(var a=0;11>=a;a++)s(j[a]);s(17);for(var o=0;16>o;o++)s(Y[o+1]);for(var u=0;161>=u;u++)s(W[u])}function p(){c(65498),c(12),s(3),s(1),s(0),s(2),s(17),s(3),s(17),s(0),s(63),s(0)}function m(e,t,r,n,i){var a,s=i[0],c=i[240];const f=16,l=63,h=64;for(var d=u(e,t),p=0;h>p;++p)E[G[p]]=d[p];var m=E[0]-r;r=E[0],0==m?o(n[0]):(a=32767+m,o(n[D[a]]),o(M[a]));for(var g=63;g>0&&0==E[g];g--);if(0==g)return o(s),r;for(var v,y=1;g>=y;){for(var b=y;0==E[y]&&g>=y;++y);var w=y-b;if(w>=f){v=w>>4;for(var x=1;v>=x;++x)o(c);w=15&w}a=32767+E[y],o(i[(w<<4)+D[a]]),o(M[a]),y++}return g!=l&&o(s),r}function g(){for(var e=String.fromCharCode,t=0;256>t;t++)z[t]=e(t)}function v(e){if(0>=e&&(e=1),e>100&&(e=100),P!=e){var r=0;r=Math.floor(50>e?5e3/e:200-2*e),t(r),P=e}}function y(){var t=(new Date).getTime();e||(e=50),g(),n(),i(),a(),v(e);(new Date).getTime()-t}var b,w,x,S,P,_=(Math.round,Math.floor),I=new Array(64),k=new Array(64),C=new Array(64),A=new Array(64),M=new Array(65535),D=new Array(65535),T=new Array(64),E=new Array(64),F=[],R=0,U=7,O=new Array(64),L=new Array(64),B=new Array(64),z=new Array(256),N=new Array(2048),G=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],H=[0,1,2,3,4,5,6,7,8,9,10,11],J=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],X=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],V=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],j=[0,1,2,3,4,5,6,7,8,9,10,11],Y=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],W=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,t){(new Date).getTime();t&&v(t),F=new Array,R=0,U=7,c(65496),f(),h(),l(e.width,e.height),d(),p();var r=0,n=0,i=0;R=0,U=7,this.encode.displayName="_encode_";for(var a,s,u,g,y,P,_,I,k,M=e.data,D=e.width,T=e.height,E=4*D,z=0;T>z;){for(a=0;E>a;){for(y=E*z+a,P=y,_=-1,I=0,k=0;64>k;k++)I=k>>3,_=4*(7&k),P=y+I*E+_,z+I>=T&&(P-=E*(z+1+I-T)),a+_>=E&&(P-=a+_-E+4),s=M[P++],u=M[P++],g=M[P++],O[k]=(N[s]+N[u+256>>0]+N[g+512>>0]>>16)-128,L[k]=(N[s+768>>0]+N[u+1024>>0]+N[g+1280>>0]>>16)-128,B[k]=(N[s+1280>>0]+N[u+1536>>0]+N[g+1792>>0]>>16)-128;r=m(O,C,r,b,x),n=m(L,A,n,w,S),i=m(B,A,i,w,S),a+=32}z+=8}if(U>=0){var G=[];G[1]=U+1,G[0]=(1<<U+1)-1,o(G)}return c(65497),new Uint8Array(F)},y()}function n(e,t){"undefined"==typeof t&&(t=50);var n=new r(t),i=n.encode(e,t);return{data:i,width:e.width,height:e.height}}t.exports=n},{}],4:[function(e,t){function r(e,t){if(0===e.indexOf("data:")){for(var r=e.indexOf("base64,")+7,n=atob(e.substring(r)),i=new Uint8Array(n.length),a=n.length-1;a>=0;a--)i[a]=n.charCodeAt(a);return void t(i.buffer)}var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){t(o.response)},o.send(null)}var n=function(){function e(){this._src=null,this._parser=new i.JpegImage,this.onload=null}return e.prototype={get src(){return this._src},set src(e){this.load(e)},get width(){return this._parser.width},get height(){return this._parser.height},load:function(e){this._src=e,r(e,function(e){this.parse(new Uint8Array(e)),this.onload&&this.onload()}.bind(this))},parse:function(e){this._parser.parse(e)},getData:function(e,t){return this._parser.getData(e,t,!1)},copyToImageData:function(e){if(2===this._parser.numComponents||this._parser.numComponents>4)throw new Error("Unsupported amount of components");var t,r,n=e.width,i=e.height,a=n*i*4,o=e.data;if(1!==this._parser.numComponents){var s=this._parser.getData(n,i,!0);for(t=0,r=0;a>t;)o[t++]=s[r++],o[t++]=s[r++],o[t++]=s[r++],o[t++]=255}else{var c=this._parser.getData(n,i,!1);for(t=0,r=0;a>t;){var u=c[r++];o[t++]=u,o[t++]=u,o[t++]=u,o[t++]=255}}}},e}();t.exports={JpegImage:n,JpegDecoder:a,JpxDecoder:o,Jbig2Decoder:s};var i;!function(e){"use strict";function t(e){for(var t=1,r=0;e>t;)t<<=1,r++;return r}function r(e,t){return e[t]<<24>>24}function n(e,t){return e[t]<<8|e[t+1]}function i(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function a(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!1}),r}var o=function(){function e(){}function t(e,t){for(var r,n,i=0,a=[],o=16;o>0&&!e[o-1];)o--;a.push({children:[],index:0});var s,c=a[0];for(r=0;o>r;r++){for(n=0;n<e[r];n++){for(c=a.pop(),c.children[c.index]=t[i];c.index>0;)c=a.pop();for(c.index++,a.push(c);a.length<=r;)a.push(s={children:[],index:0}),c.children[c.index]=s.children,c=s;i++}o>r+1&&(a.push(s={children:[],index:0}),c.children[c.index]=s.children,c=s)}return a[0].children}function r(e,t,r){return 64*((e.blocksPerLine+1)*t+r)}function n(e,t,n,i,a,o,c,u,f){function l(){if(F>0)return F--,E>>F&1;if(E=e[t++],255===E){var r=e[t++];if(r)throw"unexpected marker: "+(E<<8|r).toString(16)}return F=7,E>>>7}function h(e){for(var t=e;;){if(t=t[l()],"number"==typeof t)return t;if("object"!=typeof t)throw"invalid huffman sequence"}}function d(e){for(var t=0;e>0;)t=t<<1|l(),e--;return t}function p(e){if(1===e)return 1===l()?1:-1;var t=d(e);return t>=1<<e-1?t:t+(-1<<e)+1}function m(e,t){var r=h(e.huffmanTableDC),n=0===r?0:p(r);e.blockData[t]=e.pred+=n;for(var i=1;64>i;){var a=h(e.huffmanTableAC),o=15&a,c=a>>4;if(0!==o){i+=c;var u=s[i];e.blockData[t+u]=p(o),i++}else{if(15>c)break;i+=16}}}function g(e,t){var r=h(e.huffmanTableDC),n=0===r?0:p(r)<<f;e.blockData[t]=e.pred+=n}function v(e,t){e.blockData[t]|=l()<<f}function y(e,t){if(R>0)return void R--;for(var r=o,n=c;n>=r;){var i=h(e.huffmanTableAC),a=15&i,u=i>>4;if(0!==a){r+=u;var l=s[r];e.blockData[t+l]=p(a)*(1<<f),r++}else{if(15>u){R=d(u)+(1<<u)-1;break}r+=16}}}function b(e,t){for(var r,n,i=o,a=c,u=0;a>=i;){var m=s[i];switch(U){case 0:if(n=h(e.huffmanTableAC),r=15&n,u=n>>4,0===r)15>u?(R=d(u)+(1<<u),U=4):(u=16,U=1);else{if(1!==r)throw"invalid ACn encoding";S=p(r),U=u?2:3}continue;case 1:case 2:e.blockData[t+m]?e.blockData[t+m]+=l()<<f:(u--,0===u&&(U=2===U?3:0));break;case 3:e.blockData[t+m]?e.blockData[t+m]+=l()<<f:(e.blockData[t+m]=S<<f,U=0);break;case 4:e.blockData[t+m]&&(e.blockData[t+m]+=l()<<f)}i++}4===U&&(R--,0===R&&(U=0))}function w(e,t,n,i,a){var o=n/M|0,s=n%M,c=o*e.v+i,u=s*e.h+a,f=r(e,c,u);t(e,f)}function x(e,t,n){var i=n/e.blocksPerLine|0,a=n%e.blocksPerLine,o=r(e,i,a);t(e,o)}var S,P,_,I,k,C,A,M=(n.precision,n.samplesPerLine,n.scanLines,n.mcusPerLine),D=n.progressive,T=(n.maxH,n.maxV,t),E=0,F=0,R=0,U=0,O=i.length;A=D?0===o?0===u?g:v:0===u?y:b:m;var L,B,z=0;B=1===O?i[0].blocksPerLine*i[0].blocksPerColumn:M*n.mcusPerColumn,a||(a=B);for(var N,G;B>z;){for(_=0;O>_;_++)i[_].pred=0;if(R=0,1===O)for(P=i[0],C=0;a>C;C++)x(P,A,z),z++;else for(C=0;a>C;C++){for(_=0;O>_;_++)for(P=i[_],N=P.h,G=P.v,I=0;G>I;I++)for(k=0;N>k;k++)w(P,A,z,I,k);z++}if(F=0,L=e[t]<<8|e[t+1],65280>=L)throw"marker was not found";if(!(L>=65488&&65495>=L))break;t+=2}return t-T}function i(e,t,r){for(var n,i,a,o,s,g,v,y,b,w,x,S,P,_,I,k,C,A=e.quantizationTable,M=e.blockData,D=0;64>D;D+=8)b=M[t+D],w=M[t+D+1],x=M[t+D+2],S=M[t+D+3],P=M[t+D+4],_=M[t+D+5],I=M[t+D+6],k=M[t+D+7],b*=A[D],0!==(w|x|S|P|_|I|k)?(w*=A[D+1],x*=A[D+2],S*=A[D+3],P*=A[D+4],_*=A[D+5],I*=A[D+6],k*=A[D+7],n=p*b+128>>8,i=p*P+128>>8,a=x,o=I,s=m*(w-k)+128>>8,y=m*(w+k)+128>>8,g=S<<4,v=_<<4,n=n+i+1>>1,i=n-i,C=a*d+o*h+128>>8,a=a*h-o*d+128>>8,o=C,s=s+v+1>>1,v=s-v,y=y+g+1>>1,g=y-g,n=n+o+1>>1,o=n-o,i=i+a+1>>1,a=i-a,C=s*l+y*f+2048>>12,s=s*f-y*l+2048>>12,y=C,C=g*u+v*c+2048>>12,g=g*c-v*u+2048>>12,v=C,r[D]=n+y,r[D+7]=n-y,r[D+1]=i+v,r[D+6]=i-v,r[D+2]=a+g,r[D+5]=a-g,r[D+3]=o+s,r[D+4]=o-s):(C=p*b+512>>10,r[D]=C,r[D+1]=C,r[D+2]=C,r[D+3]=C,r[D+4]=C,r[D+5]=C,r[D+6]=C,r[D+7]=C);
for(var T=0;8>T;++T)b=r[T],w=r[T+8],x=r[T+16],S=r[T+24],P=r[T+32],_=r[T+40],I=r[T+48],k=r[T+56],0!==(w|x|S|P|_|I|k)?(n=p*b+2048>>12,i=p*P+2048>>12,a=x,o=I,s=m*(w-k)+2048>>12,y=m*(w+k)+2048>>12,g=S,v=_,n=(n+i+1>>1)+4112,i=n-i,C=a*d+o*h+2048>>12,a=a*h-o*d+2048>>12,o=C,s=s+v+1>>1,v=s-v,y=y+g+1>>1,g=y-g,n=n+o+1>>1,o=n-o,i=i+a+1>>1,a=i-a,C=s*l+y*f+2048>>12,s=s*f-y*l+2048>>12,y=C,C=g*u+v*c+2048>>12,g=g*c-v*u+2048>>12,v=C,b=n+y,k=n-y,w=i+v,I=i-v,x=a+g,_=a-g,S=o+s,P=o-s,b=16>b?0:b>=4080?255:b>>4,w=16>w?0:w>=4080?255:w>>4,x=16>x?0:x>=4080?255:x>>4,S=16>S?0:S>=4080?255:S>>4,P=16>P?0:P>=4080?255:P>>4,_=16>_?0:_>=4080?255:_>>4,I=16>I?0:I>=4080?255:I>>4,k=16>k?0:k>=4080?255:k>>4,M[t+T]=b,M[t+T+8]=w,M[t+T+16]=x,M[t+T+24]=S,M[t+T+32]=P,M[t+T+40]=_,M[t+T+48]=I,M[t+T+56]=k):(C=p*b+8192>>14,C=-2040>C?0:C>=2024?255:C+2056>>4,M[t+T]=C,M[t+T+8]=C,M[t+T+16]=C,M[t+T+24]=C,M[t+T+32]=C,M[t+T+40]=C,M[t+T+48]=C,M[t+T+56]=C)}function a(e,t){for(var n=t.blocksPerLine,a=t.blocksPerColumn,o=new Int16Array(64),s=0;a>s;s++)for(var c=0;n>c;c++){var u=r(t,s,c);i(t,u,o)}return t.blockData}function o(e){return 0>=e?0:e>=255?255:e}var s=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),c=4017,u=799,f=3406,l=2276,h=1567,d=3784,p=5793,m=2896;return e.prototype={parse:function(e){function r(){var t=e[f]<<8|e[f+1];return f+=2,t}function i(){var t=r(),n=e.subarray(f,f+t-2);return f+=n.length,n}function o(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),r=Math.ceil(e.scanLines/8/e.maxV),n=0;n<e.components.length;n++){B=e.components[n];var i=Math.ceil(Math.ceil(e.samplesPerLine/8)*B.h/e.maxH),a=Math.ceil(Math.ceil(e.scanLines/8)*B.v/e.maxV),o=t*B.h,s=r*B.v,c=64*s*(o+1);B.blockData=new Int16Array(c),B.blocksPerLine=i,B.blocksPerColumn=a}e.mcusPerLine=t,e.mcusPerColumn=r}var c,u,f=0,l=(e.length,null),h=null,d=[],p=[],m=[],g=r();if(65496!==g)throw"SOI not found";for(g=r();65497!==g;){var v,y,b;switch(g){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=i();65504===g&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(l={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===g&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&(h={version:w[5]<<8|w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var x,S=r(),P=S+f-2;P>f;){var _=e[f++],I=new Uint16Array(64);if(_>>4===0)for(y=0;64>y;y++)x=s[y],I[x]=e[f++];else{if(_>>4!==1)throw"DQT: invalid table spec";for(y=0;64>y;y++)x=s[y],I[x]=r()}d[15&_]=I}break;case 65472:case 65473:case 65474:if(c)throw"Only single frame JPEGs supported";r(),c={},c.extended=65473===g,c.progressive=65474===g,c.precision=e[f++],c.scanLines=r(),c.samplesPerLine=r(),c.components=[],c.componentIds={};var k,C=e[f++],A=0,M=0;for(v=0;C>v;v++){k=e[f];var D=e[f+1]>>4,T=15&e[f+1];D>A&&(A=D),T>M&&(M=T);var E=e[f+2];b=c.components.push({h:D,v:T,quantizationTable:d[E]}),c.componentIds[k]=b-1,f+=3}c.maxH=A,c.maxV=M,o(c);break;case 65476:var F=r();for(v=2;F>v;){var R=e[f++],U=new Uint8Array(16),O=0;for(y=0;16>y;y++,f++)O+=U[y]=e[f];var L=new Uint8Array(O);for(y=0;O>y;y++,f++)L[y]=e[f];v+=17+O,(R>>4===0?m:p)[15&R]=t(U,L)}break;case 65501:r(),u=r();break;case 65498:var B,z=(r(),e[f++]),N=[];for(v=0;z>v;v++){var G=c.componentIds[e[f++]];B=c.components[G];var q=e[f++];B.huffmanTableDC=m[q>>4],B.huffmanTableAC=p[15&q],N.push(B)}var H=e[f++],J=e[f++],X=e[f++],V=n(e,f,c,N,u,H,J,X>>4,15&X);f+=V;break;case 65535:255!==e[f]&&f--;break;default:if(255===e[f-3]&&e[f-2]>=192&&e[f-2]<=254){f-=3;break}throw"unknown JPEG marker "+g.toString(16)}g=r()}for(this.width=c.samplesPerLine,this.height=c.scanLines,this.jfif=l,this.adobe=h,this.components=[],v=0;v<c.components.length;v++)B=c.components[v],this.components.push({output:a(c,B),scaleX:B.h/c.maxH,scaleY:B.v/c.maxV,blocksPerLine:B.blocksPerLine,blocksPerColumn:B.blocksPerColumn});this.numComponents=this.components.length},_getLinearizedBlockData:function(e,t){var r,n,i,a,o,s,c,u,f,l,h,d=this.width/e,p=this.height/t,m=0,g=this.components.length,v=e*t*g,y=new Uint8Array(v),b=new Uint32Array(e),w=4294967288;for(c=0;g>c;c++){for(r=this.components[c],n=r.scaleX*d,i=r.scaleY*p,m=c,h=r.output,a=r.blocksPerLine+1<<3,o=0;e>o;o++)u=0|o*n,b[o]=(u&w)<<3|7&u;for(s=0;t>s;s++)for(u=0|s*i,l=a*(u&w)|(7&u)<<3,o=0;e>o;o++)y[m]=h[l+b[o]],m+=g}var x=this.decodeTransform;if(x)for(c=0;v>c;)for(u=0,f=0;g>u;u++,c++,f+=2)y[c]=(y[c]*x[f]>>8)+x[f+1];return y},_isColorConversionNeeded:function(){return this.adobe&&this.adobe.transformCode?!0:3===this.numComponents?!0:!1},_convertYccToRgb:function(e){for(var t,r,n,i=0,a=e.length;a>i;i+=3)t=e[i],r=e[i+1],n=e[i+2],e[i]=o(t-179.456+1.402*n),e[i+1]=o(t+135.459-.344*r-.714*n),e[i+2]=o(t-226.816+1.772*r);return e},_convertYcckToRgb:function(e){for(var t,r,n,i,a=0,s=0,c=e.length;c>s;s+=4){t=e[s],r=e[s+1],n=e[s+2],i=e[s+3];var u=-122.67195406894+r*(-660635669420364e-19*r+.000437130475926232*n-54080610064599e-18*t+.00048449797120281*i-.154362151871126)+n*(-.000957964378445773*n+.000817076911346625*t-.00477271405408747*i+1.53380253221734)+t*(.000961250184130688*t-.00266257332283933*i+.48357088451265)+i*(-.000336197177618394*i+.484791561490776),f=107.268039397724+r*(219927104525741e-19*r-.000640992018297945*n+.000659397001245577*t+.000426105652938837*i-.176491792462875)+n*(-.000778269941513683*n+.00130872261408275*t+.000770482631801132*i-.151051492775562)+t*(.00126935368114843*t-.00265090189010898*i+.25802910206845)+i*(-.000318913117588328*i-.213742400323665),l=-20.810012546947+r*(-.000570115196973677*r-263409051004589e-19*n+.0020741088115012*t-.00288260236853442*i+.814272968359295)+n*(-153496057440975e-19*n-.000132689043961446*t+.000560833691242812*i-.195152027534049)+t*(.00174418132927582*t-.00255243321439347*i+.116935020465145)+i*(-.000343531996510555*i+.24165260232407);e[a++]=o(u),e[a++]=o(f),e[a++]=o(l)}return e},_convertYcckToCmyk:function(e){for(var t,r,n,i=0,a=e.length;a>i;i+=4)t=e[i],r=e[i+1],n=e[i+2],e[i]=o(434.456-t-1.402*n),e[i+1]=o(119.541-t+.344*r+.714*n),e[i+2]=o(481.816-t-1.772*r);return e},_convertCmykToRgb:function(e){for(var t,r,n,i,a=0,o=-16581375,s=1/255/255,c=0,u=e.length;u>c;c+=4){t=e[c],r=e[c+1],n=e[c+2],i=e[c+3];var f=t*(-4.387332384609988*t+54.48615194189176*r+18.82290502165302*n+212.25662451639585*i-72734.4411664936)+r*(1.7149763477362134*r-5.6096736904047315*n-17.873870861415444*i-1401.7366389350734)+n*(-2.5217340131683033*n-21.248923337353073*i+4465.541406466231)-i*(21.86122147463605*i+48317.86113160301),l=t*(8.841041422036149*t+60.118027045597366*r+6.871425592049007*n+31.159100130055922*i-20220.756542821975)+r*(-15.310361306967817*r+17.575251261109482*n+131.35250912493976*i-48691.05921601825)+n*(4.444339102852739*n+9.8632861493405*i-6341.191035517494)-i*(20.737325471181034*i+47890.15695978492),h=t*(.8842522430003296*t+8.078677503112928*r+30.89978309703729*n-.23883238689178934*i-3616.812083916688)+r*(10.49593273432072*r+63.02378494754052*n+50.606957656360734*i-28620.90484698408)+n*(.03296041114873217*n+115.60384449646641*i-49363.43385999684)-i*(22.33816807309886*i+45932.16563550634);e[a++]=f>=0?255:o>=f?0:255+f*s|0,e[a++]=l>=0?255:o>=l?0:255+l*s|0,e[a++]=h>=0?255:o>=h?0:255+h*s|0}return e},getData:function(e,t,r){if(this.numComponents>4)throw"Unsupported color mode";var n=this._getLinearizedBlockData(e,t);if(3===this.numComponents)return this._convertYccToRgb(n);if(4===this.numComponents){if(this._isColorConversionNeeded())return r?this._convertYcckToRgb(n):this._convertYcckToCmyk(n);if(r)return this._convertCmykToRgb(n)}return n}},e}(),s=function(){function e(e,t,r){this.data=e,this.bp=t,this.dataEnd=r,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}var t=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return e.prototype={byteIn:function(){var e=this.data,t=this.bp;if(255===e[t]){var r=e[t+1];r>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,r){var n,i=e[r]>>1,a=1&e[r],o=t[i],s=o.qe,c=this.a-s;if(this.chigh<s)s>c?(c=s,n=a,i=o.nmps):(c=s,n=1^a,1===o.switchFlag&&(a=n),i=o.nlps);else{if(this.chigh-=s,0!==(32768&c))return this.a=c,a;s>c?(n=1^a,1===o.switchFlag&&(a=n),i=o.nlps):(n=a,i=o.nmps)}do 0===this.ct&&this.byteIn(),c<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--;while(0===(32768&c));return this.a=c,e[r]=i<<1|a,n}},e}(),c=function(){function e(){this.failOnCorruptedImage=!1}function r(e,t){e.x0=Math.ceil(t.XOsiz/e.XRsiz),e.x1=Math.ceil(t.Xsiz/e.XRsiz),e.y0=Math.ceil(t.YOsiz/e.YRsiz),e.y1=Math.ceil(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function a(e,t){for(var r,n=e.SIZ,i=[],a=Math.ceil((n.Xsiz-n.XTOsiz)/n.XTsiz),o=Math.ceil((n.Ysiz-n.YTOsiz)/n.YTsiz),s=0;o>s;s++)for(var c=0;a>c;c++)r={},r.tx0=Math.max(n.XTOsiz+c*n.XTsiz,n.XOsiz),r.ty0=Math.max(n.YTOsiz+s*n.YTsiz,n.YOsiz),r.tx1=Math.min(n.XTOsiz+(c+1)*n.XTsiz,n.Xsiz),r.ty1=Math.min(n.YTOsiz+(s+1)*n.YTsiz,n.Ysiz),r.width=r.tx1-r.tx0,r.height=r.ty1-r.ty0,r.components=[],i.push(r);e.tiles=i;for(var u=n.Csiz,f=0,l=u;l>f;f++)for(var h=t[f],d=0,p=i.length;p>d;d++){var m={};r=i[d],m.tcx0=Math.ceil(r.tx0/h.XRsiz),m.tcy0=Math.ceil(r.ty0/h.YRsiz),m.tcx1=Math.ceil(r.tx1/h.XRsiz),m.tcy1=Math.ceil(r.ty1/h.YRsiz),m.width=m.tcx1-m.tcx0,m.height=m.tcy1-m.tcy0,r.components[f]=m}}function o(e,t,r){var n=t.codingStyleParameters,i={};return n.entropyCoderWithCustomPrecincts?(i.PPx=n.precinctsSizes[r].PPx,i.PPy=n.precinctsSizes[r].PPy):(i.PPx=15,i.PPy=15),i.xcb_=r>0?Math.min(n.xcb,i.PPx-1):Math.min(n.xcb,i.PPx),i.ycb_=r>0?Math.min(n.ycb,i.PPy-1):Math.min(n.ycb,i.PPy),i}function c(e,t,r){var n=1<<r.PPx,i=1<<r.PPy,a=0===t.resLevel,o=1<<r.PPx+(a?0:-1),s=1<<r.PPy+(a?0:-1),c=t.trx1>t.trx0?Math.ceil(t.trx1/n)-Math.floor(t.trx0/n):0,u=t.try1>t.try0?Math.ceil(t.try1/i)-Math.floor(t.try0/i):0,f=c*u;t.precinctParameters={precinctWidth:n,precinctHeight:i,numprecinctswide:c,numprecinctshigh:u,numprecincts:f,precinctWidthInSubband:o,precinctHeightInSubband:s}}function u(e,t,r){var n,i,a,o,s=r.xcb_,c=r.ycb_,u=1<<s,f=1<<c,l=t.tbx0>>s,h=t.tby0>>c,d=t.tbx1+u-1>>s,p=t.tby1+f-1>>c,m=t.resolution.precinctParameters,g=[],v=[];for(i=h;p>i;i++)for(n=l;d>n;n++){a={cbx:n,cby:i,tbx0:u*n,tby0:f*i,tbx1:u*(n+1),tby1:f*(i+1)},a.tbx0_=Math.max(t.tbx0,a.tbx0),a.tby0_=Math.max(t.tby0,a.tby0),a.tbx1_=Math.min(t.tbx1,a.tbx1),a.tby1_=Math.min(t.tby1,a.tby1);var y=Math.floor((a.tbx0_-t.tbx0)/m.precinctWidthInSubband),b=Math.floor((a.tby0_-t.tby0)/m.precinctHeightInSubband);if(o=y+b*m.numprecinctswide,a.precinctNumber=o,a.subbandType=t.type,a.Lblock=3,!(a.tbx1_<=a.tbx0_||a.tby1_<=a.tby0_)){g.push(a);var w=v[o];void 0!==w?(n<w.cbxMin?w.cbxMin=n:n>w.cbxMax&&(w.cbxMax=n),i<w.cbyMin?w.cbxMin=i:i>w.cbyMax&&(w.cbyMax=i)):v[o]=w={cbxMin:n,cbyMin:i,cbxMax:n,cbyMax:i},a.precinct=w}}t.codeblockParameters={codeblockWidth:s,codeblockHeight:c,numcodeblockwide:d-l+1,numcodeblockhigh:p-h+1},t.codeblocks=g,t.precincts=v}function f(e,t,r){for(var n=[],i=e.subbands,a=0,o=i.length;o>a;a++)for(var s=i[a],c=s.codeblocks,u=0,f=c.length;f>u;u++){var l=c[u];l.precinctNumber===t&&n.push(l)}return{layerNumber:r,codeblocks:n}}function d(e){for(var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;a>s;s++)o=Math.max(o,n.components[s].codingStyleParameters.decompositionLevelsCount);var c=0,u=0,l=0,h=0;this.nextPacket=function(){for(;i>c;c++){for(;o>=u;u++){for(;a>l;l++){var e=n.components[l];if(!(u>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[u],r=t.precinctParameters.numprecincts;r>h;){var s=f(t,h,c);return h++,s}h=0}}l=0}u=0}throw new Error("JPX Error: Out of packets")}}function p(e){for(var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;a>s;s++)o=Math.max(o,n.components[s].codingStyleParameters.decompositionLevelsCount);var c=0,u=0,l=0,h=0;this.nextPacket=function(){for(;o>=c;c++){for(;i>u;u++){for(;a>l;l++){var e=n.components[l];if(!(c>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[c],r=t.precinctParameters.numprecincts;r>h;){var s=f(t,h,u);return h++,s}h=0}}l=0}u=0}throw new Error("JPX Error: Out of packets")}}function m(e){var t,r,n,i,a=e.SIZ,o=e.currentTile.index,s=e.tiles[o],c=s.codingStyleDefaultParameters.layersCount,u=a.Csiz,l=0;for(n=0;u>n;n++){var h=s.components[n];l=Math.max(l,h.codingStyleParameters.decompositionLevelsCount)}var d=new Int32Array(l+1);for(r=0;l>=r;++r){var p=0;for(n=0;u>n;++n){var m=s.components[n].resolutions;r<m.length&&(p=Math.max(p,m[r].precinctParameters.numprecincts))}d[r]=p}t=0,r=0,n=0,i=0,this.nextPacket=function(){for(;l>=r;r++){for(;i<d[r];i++){for(;u>n;n++){var e=s.components[n];if(!(r>e.codingStyleParameters.decompositionLevelsCount)){var a=e.resolutions[r],o=a.precinctParameters.numprecincts;if(!(i>=o)){for(;c>t;){var h=f(a,i,t);return t++,h}t=0}}}n=0}i=0}throw new Error("JPX Error: Out of packets")}}function g(e){var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(n),s=o,c=0,u=0,l=0,h=0,d=0;this.nextPacket=function(){for(;d<s.maxNumHigh;d++){for(;h<s.maxNumWide;h++){for(;a>l;l++){for(var e=n.components[l],t=e.codingStyleParameters.decompositionLevelsCount;t>=u;u++){var r=e.resolutions[u],p=o.components[l].resolutions[u],m=y(h,d,p,s,r);if(null!==m){for(;i>c;){var g=f(r,m,c);return c++,g}c=0}}u=0}l=0}h=0}throw new Error("JPX Error: Out of packets")}}function v(e){var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(n),s=0,c=0,u=0,l=0,h=0;this.nextPacket=function(){for(;a>u;++u){for(var e=n.components[u],t=o.components[u],r=e.codingStyleParameters.decompositionLevelsCount;h<t.maxNumHigh;h++){for(;l<t.maxNumWide;l++){for(;r>=c;c++){var d=e.resolutions[c],p=t.resolutions[c],m=y(l,h,p,t,d);if(null!==m){for(;i>s;){var g=f(d,m,s);return s++,g}s=0}}c=0}l=0}h=0}throw new Error("JPX Error: Out of packets")}}function y(e,t,r,n,i){var a=e*n.minWidth,o=t*n.minHeight;if(a%r.width!==0||o%r.height!==0)return null;var s=o/r.width*i.precinctParameters.numprecinctswide;return a/r.height+s}function b(e){for(var t=e.components.length,r=Number.MAX_VALUE,n=Number.MAX_VALUE,i=0,a=0,o=new Array(t),s=0;t>s;s++){for(var c=e.components[s],u=c.codingStyleParameters.decompositionLevelsCount,f=new Array(u+1),l=Number.MAX_VALUE,h=Number.MAX_VALUE,d=0,p=0,m=1,g=u;g>=0;--g){var v=c.resolutions[g],y=m*v.precinctParameters.precinctWidth,b=m*v.precinctParameters.precinctHeight;l=Math.min(l,y),h=Math.min(h,b),d=Math.max(d,v.precinctParameters.numprecinctswide),p=Math.max(p,v.precinctParameters.numprecinctshigh),f[g]={width:y,height:b},m<<=1}r=Math.min(r,l),n=Math.min(n,h),i=Math.max(i,d),a=Math.max(a,p),o[s]={resolutions:f,minWidth:l,minHeight:h,maxNumWide:d,maxNumHigh:p}}return{components:o,minWidth:r,minHeight:n,maxNumWide:i,maxNumHigh:a}}function w(e){for(var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=t.Csiz,a=0;i>a;a++){for(var s=n.components[a],f=s.codingStyleParameters.decompositionLevelsCount,l=[],h=[],y=0;f>=y;y++){var b=o(e,s,y),w={},x=1<<f-y;w.trx0=Math.ceil(s.tcx0/x),w.try0=Math.ceil(s.tcy0/x),w.trx1=Math.ceil(s.tcx1/x),w.try1=Math.ceil(s.tcy1/x),w.resLevel=y,c(e,w,b),l.push(w);var S;if(0===y)S={},S.type="LL",S.tbx0=Math.ceil(s.tcx0/x),S.tby0=Math.ceil(s.tcy0/x),S.tbx1=Math.ceil(s.tcx1/x),S.tby1=Math.ceil(s.tcy1/x),S.resolution=w,u(e,S,b),h.push(S),w.subbands=[S];else{var P=1<<f-y+1,_=[];S={},S.type="HL",S.tbx0=Math.ceil(s.tcx0/P-.5),S.tby0=Math.ceil(s.tcy0/P),S.tbx1=Math.ceil(s.tcx1/P-.5),S.tby1=Math.ceil(s.tcy1/P),S.resolution=w,u(e,S,b),h.push(S),_.push(S),S={},S.type="LH",S.tbx0=Math.ceil(s.tcx0/P),S.tby0=Math.ceil(s.tcy0/P-.5),S.tbx1=Math.ceil(s.tcx1/P),S.tby1=Math.ceil(s.tcy1/P-.5),S.resolution=w,u(e,S,b),h.push(S),_.push(S),S={},S.type="HH",S.tbx0=Math.ceil(s.tcx0/P-.5),S.tby0=Math.ceil(s.tcy0/P-.5),S.tbx1=Math.ceil(s.tcx1/P-.5),S.tby1=Math.ceil(s.tcy1/P-.5),S.resolution=w,u(e,S,b),h.push(S),_.push(S),w.subbands=_}}s.resolutions=l,s.subbands=h}var I=n.codingStyleDefaultParameters.progressionOrder;switch(I){case 0:n.packetsIterator=new d(e);break;case 1:n.packetsIterator=new p(e);break;case 2:n.packetsIterator=new m(e);break;case 3:n.packetsIterator=new g(e);break;case 4:n.packetsIterator=new v(e);break;default:throw new Error("JPX Error: Unsupported progression order "+I)}}function x(e,r,n,i){function a(e){for(;e>h;){var t=r[n+l];l++,d?(f=f<<7|t,h+=7,d=!1):(f=f<<8|t,h+=8),255===t&&(d=!0)}return h-=e,f>>>h&(1<<e)-1}function o(e){return 255===r[n+l-1]&&r[n+l]===e?(s(1),!0):255===r[n+l]&&r[n+l+1]===e?(s(2),!0):!1}function s(e){l+=e}function c(){h=0,d&&(l++,d=!1)}function u(){if(0===a(1))return 1;if(0===a(1))return 2;var e=a(2);return 3>e?e+3:(e=a(5),31>e?e+6:(e=a(7),e+37))}for(var f,l=0,h=0,d=!1,p=e.currentTile.index,m=e.tiles[p],g=e.COD.sopMarkerUsed,v=e.COD.ephMarkerUsed,y=m.packetsIterator;i>l;){c(),g&&o(145)&&s(4);var b=y.nextPacket();if(a(1)){for(var w,x=b.layerNumber,S=[],P=0,_=b.codeblocks.length;_>P;P++){w=b.codeblocks[P];var I,k=w.precinct,M=w.cbx-k.cbxMin,D=w.cby-k.cbyMin,T=!1,E=!1;if(void 0!==w.included)T=!!a(1);else{k=w.precinct;var F,R;if(void 0!==k.inclusionTree)F=k.inclusionTree;else{var U=k.cbxMax-k.cbxMin+1,O=k.cbyMax-k.cbyMin+1;F=new A(U,O,x),R=new C(U,O),k.inclusionTree=F,k.zeroBitPlanesTree=R}if(F.reset(M,D,x))for(;;){if(!a(1)){F.incrementValue(x);break}if(I=!F.nextLevel()){w.included=!0,T=E=!0;break}}}if(T){if(E){for(R=k.zeroBitPlanesTree,R.reset(M,D);;)if(a(1)){if(I=!R.nextLevel())break}else R.incrementValue();w.zeroBitPlanes=R.value}for(var L=u();a(1);)w.Lblock++;var B=t(L),z=(1<<B>L?B-1:B)+w.Lblock,N=a(z);S.push({codeblock:w,codingpasses:L,dataLength:N})}}for(c(),v&&o(146);S.length>0;){var G=S.shift();w=G.codeblock,void 0===w.data&&(w.data=[]),w.data.push({data:r,start:n+l,end:n+l+G.dataLength,codingpasses:G.codingpasses}),l+=G.dataLength}}}return l}function S(e,t,r,n,i,a,o,c){for(var u=n.tbx0,f=n.tby0,l=n.tbx1-n.tbx0,h=n.codeblocks,d="H"===n.type.charAt(0)?1:0,p="H"===n.type.charAt(1)?t:0,m=0,g=h.length;g>m;++m){var v=h[m],y=v.tbx1_-v.tbx0_,b=v.tby1_-v.tby0_;if(0!==y&&0!==b&&void 0!==v.data){var w,x;w=new M(y,b,v.subbandType,v.zeroBitPlanes,a),x=2;var S,P,_,I=v.data,k=0,C=0;for(S=0,P=I.length;P>S;S++)_=I[S],k+=_.end-_.start,C+=_.codingpasses;var A=new Uint8Array(k),D=0;for(S=0,P=I.length;P>S;S++){_=I[S];var T=_.data.subarray(_.start,_.end);A.set(T,D),D+=T.length}var E=new s(A,0,k);for(w.setDecoder(E),S=0;C>S;S++){switch(x){case 0:w.runSignificancePropogationPass();break;case 1:w.runMagnitudeRefinementPass();break;case 2:w.runCleanupPass(),c&&w.checkSegmentationSymbol()}x=(x+1)%3}var F,R,U,O=v.tbx0_-u+(v.tby0_-f)*l,L=w.coefficentsSign,B=w.coefficentsMagnitude,z=w.bitsDecoded,N=o?0:.5;D=0;var G="LL"!==n.type;for(S=0;b>S;S++){var q=O/l|0,H=2*q*(t-l)+d+p;for(F=0;y>F;F++){if(R=B[D],0!==R){R=(R+N)*i,0!==L[D]&&(R=-R),U=z[D];var J=G?H+(O<<1):O;e[J]=o&&U>=a?R:R*(1<<a-U)}O++,D++}O+=l-y}}}}function P(e,t,r){for(var n=t.components[r],i=n.codingStyleParameters,a=n.quantizationParameters,o=i.decompositionLevelsCount,s=a.SPqcds,c=a.scalarExpounded,u=a.guardBits,f=i.segmentationSymbolUsed,l=e.components[r].precision,h=i.reversibleTransformation,d=h?new E:new T,p=[],m=0,g=0;o>=g;g++){for(var v=n.resolutions[g],y=v.trx1-v.trx0,b=v.try1-v.try0,w=new Float32Array(y*b),x=0,P=v.subbands.length;P>x;x++){var _,I;c?(_=s[m].mu,I=s[m].epsilon,m++):(_=s[0].mu,I=s[0].epsilon+(g>0?1-g:0));var C=v.subbands[x],A=k[C.type],M=h?1:Math.pow(2,l+A-I)*(1+_/2048),D=u+I-1;S(w,y,b,C,M,D,h,f)}p.push({width:y,height:b,items:w})}var F=d.calculate(p,n.tcx0,n.tcy0);return{left:n.tcx0,top:n.tcy0,width:F.width,height:F.height,items:F.items}}function _(e){for(var t=e.SIZ,r=e.components,n=t.Csiz,i=[],a=0,o=e.tiles.length;o>a;a++){var s,c=e.tiles[a],u=[];for(s=0;n>s;s++)u[s]=P(e,c,s);var f,l,h,d,p,m,g,v,y,b,w,x,S,_,I,k=u[0],C=new Uint8Array(k.items.length*n),A={left:k.left,top:k.top,width:k.width,height:k.height,items:C},M=0;if(c.codingStyleDefaultParameters.multipleComponentTransform){var D=4===n,T=u[0].items,E=u[1].items,F=u[2].items,R=D?u[3].items:null;f=r[0].precision-8,l=(128<<f)+.5,h=255*(1<<f),p=.5*h,d=-p;var U=c.components[0],O=n-3;if(g=T.length,U.codingStyleParameters.reversibleTransformation)for(m=0;g>m;m++,M+=O)v=T[m]+l,y=E[m],b=F[m],x=v-(b+y>>2),w=x+b,S=x+y,C[M++]=0>=w?0:w>=h?255:w>>f,C[M++]=0>=x?0:x>=h?255:x>>f,C[M++]=0>=S?0:S>=h?255:S>>f;else for(m=0;g>m;m++,M+=O)v=T[m]+l,y=E[m],b=F[m],w=v+1.402*b,x=v-.34413*y-.71414*b,S=v+1.772*y,C[M++]=0>=w?0:w>=h?255:w>>f,C[M++]=0>=x?0:x>=h?255:x>>f,C[M++]=0>=S?0:S>=h?255:S>>f;if(D)for(m=0,M=3;g>m;m++,M+=4)_=R[m],C[M]=d>=_?0:_>=p?255:_+l>>f}else for(s=0;n>s;s++){var L=u[s].items;for(f=r[s].precision-8,l=(128<<f)+.5,h=127.5*(1<<f),d=-h,M=s,m=0,g=L.length;g>m;m++)I=L[m],C[M]=d>=I?0:I>=h?255:I+l>>f,M+=n}i.push(A)}return i}function I(e,t){for(var r=e.SIZ,n=r.Csiz,i=e.tiles[t],a=0;n>a;a++){var o=i.components[a],s=void 0!==e.currentTile.QCC[a]?e.currentTile.QCC[a]:e.currentTile.QCD;o.quantizationParameters=s;var c=void 0!==e.currentTile.COC[a]?e.currentTile.COC[a]:e.currentTile.COD;o.codingStyleParameters=c}i.codingStyleDefaultParameters=e.currentTile.COD}var k={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=n(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var r=0,a=e.length;a>r;){var o=8,s=i(e,r),c=i(e,r+4);if(r+=o,1===s&&(s=4294967296*i(e,r)+i(e,r+4),r+=8,o+=8),0===s&&(s=a-r+o),o>s)throw new Error("JPX Error: Invalid box field size");var u=s-o,f=!0;switch(c){case 1785737832:f=!1;break;case 1668246642:{var d=e[r];e[r+1],e[r+2]}if(1===d){var p=i(e,r+3);switch(p){case 16:case 17:case 18:break;default:l("Unknown colorspace "+p)}}else 2===d&&h("ICC profile not supported");break;case 1785737827:this.parseCodestream(e,r,r+u);break;case 1783636e3:218793738!==i(e,r)&&l("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var m=String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,255&c);l("Unsupported header type "+c+" ("+m+")")}f&&(r+=u)}},parseImageProperties:function(e){for(var t=e.getByte();t>=0;){var r=t;t=e.getByte();var n=r<<8|t;if(65361===n){e.skip(4);var i=e.getInt32()>>>0,a=e.getInt32()>>>0,o=e.getInt32()>>>0,s=e.getInt32()>>>0;e.skip(16);var c=e.getUint16();return this.width=i-o,this.height=a-s,this.componentsCount=c,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(e,t,o){var s={};try{for(var c=!1,u=t;o>u+1;){var f=n(e,u);u+=2;var h,d,p,m,g,v,y=0;switch(f){case 65359:s.mainHeader=!0;break;case 65497:break;case 65361:y=n(e,u);var b={};b.Xsiz=i(e,u+4),b.Ysiz=i(e,u+8),b.XOsiz=i(e,u+12),b.YOsiz=i(e,u+16),b.XTsiz=i(e,u+20),b.YTsiz=i(e,u+24),b.XTOsiz=i(e,u+28),b.YTOsiz=i(e,u+32);var S=n(e,u+36);b.Csiz=S;var P=[];h=u+38;for(var k=0;S>k;k++){var C={precision:(127&e[h])+1,isSigned:!!(128&e[h]),XRsiz:e[h+1],YRsiz:e[h+1]};r(C,b),P.push(C)}s.SIZ=b,s.components=P,a(s,P),s.QCC=[],s.COC=[];break;case 65372:y=n(e,u);var A={};switch(h=u+2,d=e[h++],31&d){case 0:m=8,g=!0;break;case 1:m=16,g=!1;break;case 2:m=16,g=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+d)}for(A.noQuantization=8===m,A.scalarExpounded=g,A.guardBits=d>>5,p=[];y+u>h;){var M={};8===m?(M.epsilon=e[h++]>>3,M.mu=0):(M.epsilon=e[h]>>3,M.mu=(7&e[h])<<8|e[h+1],h+=2),p.push(M)}A.SPqcds=p,s.mainHeader?s.QCD=A:(s.currentTile.QCD=A,s.currentTile.QCC=[]);break;case 65373:y=n(e,u);var D={};h=u+2;var T;switch(s.SIZ.Csiz<257?T=e[h++]:(T=n(e,h),h+=2),d=e[h++],31&d){case 0:m=8,g=!0;break;case 1:m=16,g=!1;break;case 2:m=16,g=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+d)}for(D.noQuantization=8===m,D.scalarExpounded=g,D.guardBits=d>>5,p=[];y+u>h;)M={},8===m?(M.epsilon=e[h++]>>3,M.mu=0):(M.epsilon=e[h]>>3,M.mu=(7&e[h])<<8|e[h+1],h+=2),p.push(M);D.SPqcds=p,s.mainHeader?s.QCC[T]=D:s.currentTile.QCC[T]=D;break;case 65362:y=n(e,u);var E={};h=u+2;var F=e[h++];E.entropyCoderWithCustomPrecincts=!!(1&F),E.sopMarkerUsed=!!(2&F),E.ephMarkerUsed=!!(4&F),E.progressionOrder=e[h++],E.layersCount=n(e,h),h+=2,E.multipleComponentTransform=e[h++],E.decompositionLevelsCount=e[h++],E.xcb=(15&e[h++])+2,E.ycb=(15&e[h++])+2;var R=e[h++];if(E.selectiveArithmeticCodingBypass=!!(1&R),E.resetContextProbabilities=!!(2&R),E.terminationOnEachCodingPass=!!(4&R),E.verticalyStripe=!!(8&R),E.predictableTermination=!!(16&R),E.segmentationSymbolUsed=!!(32&R),E.reversibleTransformation=e[h++],E.entropyCoderWithCustomPrecincts){for(var U=[];y+u>h;){var O=e[h++];U.push({PPx:15&O,PPy:O>>4})}E.precinctsSizes=U}var L=[];if(E.selectiveArithmeticCodingBypass&&L.push("selectiveArithmeticCodingBypass"),E.resetContextProbabilities&&L.push("resetContextProbabilities"),E.terminationOnEachCodingPass&&L.push("terminationOnEachCodingPass"),E.verticalyStripe&&L.push("verticalyStripe"),E.predictableTermination&&L.push("predictableTermination"),L.length>0)throw c=!0,new Error("JPX Error: Unsupported COD options ("+L.join(", ")+")");s.mainHeader?s.COD=E:(s.currentTile.COD=E,s.currentTile.COC=[]);break;case 65424:y=n(e,u),v={},v.index=n(e,u+2),v.length=i(e,u+4),v.dataEnd=v.length+u-2,v.partIndex=e[u+8],v.partsCount=e[u+9],s.mainHeader=!1,0===v.partIndex&&(v.COD=s.COD,v.COC=s.COC.slice(0),v.QCD=s.QCD,v.QCC=s.QCC.slice(0)),s.currentTile=v;break;case 65427:v=s.currentTile,0===v.partIndex&&(I(s,v.index),w(s)),y=v.dataEnd-u,x(s,e,u,y);break;case 65365:case 65367:case 65368:case 65380:y=n(e,u);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+f.toString(16))}u+=y}}catch(B){if(c||this.failOnCorruptedImage)throw B;l("Trying to recover from "+B.message)}this.tiles=_(s),this.width=s.SIZ.Xsiz-s.SIZ.XOsiz,this.height=s.SIZ.Ysiz-s.SIZ.YOsiz,this.componentsCount=s.SIZ.Csiz}};var C=function(){function e(e,r){var n=t(Math.max(e,r))+1;this.levels=[];for(var i=0;n>i;i++){var a={width:e,height:r,items:[]};this.levels.push(a),e=Math.ceil(e/2),r=Math.ceil(r/2)}}return e.prototype={reset:function(e,t){for(var r,n=0,i=0;n<this.levels.length;){r=this.levels[n];var a=e+t*r.width;if(void 0!==r.items[a]){i=r.items[a];break}r.index=a,e>>=1,t>>=1,n++}n--,r=this.levels[n],r.items[r.index]=i,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],r=t.items[t.index];return e--,0>e?(this.value=r,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=r,!0)}},e}(),A=function(){function e(e,r,n){var i=t(Math.max(e,r))+1;this.levels=[];for(var a=0;i>a;a++){for(var o=new Uint8Array(e*r),s=0,c=o.length;c>s;s++)o[s]=n;var u={width:e,height:r,items:o};this.levels.push(u),e=Math.ceil(e/2),r=Math.ceil(r/2)}}return e.prototype={reset:function(e,t,r){for(var n=0;n<this.levels.length;){var i=this.levels[n],a=e+t*i.width;i.index=a;var o=i.items[a];if(255===o)break;if(o>r)return this.currentLevel=n,this.propagateValues(),!1;e>>=1,t>>=1,n++}return this.currentLevel=n-1,!0},incrementValue:function(e){var t=this.levels[this.currentLevel];t.items[t.index]=e+1,this.propagateValues()},propagateValues:function(){for(var e=this.currentLevel,t=this.levels[e],r=t.items[t.index];--e>=0;)t=this.levels[e],t.items[t.index]=r},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],r=t.items[t.index];return t.items[t.index]=255,e--,0>e?!1:(this.currentLevel=e,t=this.levels[e],t.items[t.index]=r,!0)}},e}(),M=function(){function e(e,t,r,o,s){this.width=e,this.height=t,this.contextLabelTable="HH"===r?a:"HL"===r?i:n;var c=e*t;this.neighborsSignificance=new Uint8Array(c),this.coefficentsSign=new Uint8Array(c),this.coefficentsMagnitude=s>14?new Uint32Array(c):s>6?new Uint16Array(c):new Uint8Array(c),this.processingFlags=new Uint8Array(c);var u=new Uint8Array(c);if(0!==o)for(var f=0;c>f;f++)u[f]=o;this.bitsDecoded=u,this.reset()}var t=17,r=18,n=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),i=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),a=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[r]=6},setNeighborsSignificance:function(e,t,r){var n,i=this.neighborsSignificance,a=this.width,o=this.height,s=t>0,c=a>t+1;e>0&&(n=r-a,s&&(i[n-1]+=16),c&&(i[n+1]+=16),i[n]+=4),o>e+1&&(n=r+a,s&&(i[n-1]+=16),c&&(i[n+1]+=16),i[n]+=4),s&&(i[r-1]+=1),c&&(i[r+1]+=1),i[r]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,r=this.height,n=this.coefficentsMagnitude,i=this.coefficentsSign,a=this.neighborsSignificance,o=this.processingFlags,s=this.contexts,c=this.contextLabelTable,u=this.bitsDecoded,f=-2,l=1,h=2,d=0;r>d;d+=4)for(var p=0;t>p;p++)for(var m=d*t+p,g=0;4>g;g++,m+=t){var v=d+g;if(v>=r)break;if(o[m]&=f,!n[m]&&a[m]){var y=c[a[m]],b=e.readBit(s,y);if(b){var w=this.decodeSignBit(v,p,m);i[m]=w,n[m]=1,this.setNeighborsSignificance(v,p,m),o[m]|=h}u[m]++,o[m]|=l}}},decodeSignBit:function(e,t,r){var n,i,a,o,s,c,u=this.width,f=this.height,l=this.coefficentsMagnitude,h=this.coefficentsSign;o=t>0&&0!==l[r-1],u>t+1&&0!==l[r+1]?(a=h[r+1],o?(i=h[r-1],n=1-a-i):n=1-a-a):o?(i=h[r-1],n=1-i-i):n=0;var d=3*n;return o=e>0&&0!==l[r-u],f>e+1&&0!==l[r+u]?(a=h[r+u],o?(i=h[r-u],n=1-a-i+d):n=1-a-a+d):o?(i=h[r-u],n=1-i-i+d):n=d,n>=0?(s=9+n,c=this.decoder.readBit(this.contexts,s)):(s=9-n,c=1^this.decoder.readBit(this.contexts,s)),c
},runMagnitudeRefinementPass:function(){for(var e,t=this.decoder,r=this.width,n=this.height,i=this.coefficentsMagnitude,a=this.neighborsSignificance,o=this.contexts,s=this.bitsDecoded,c=this.processingFlags,u=1,f=2,l=r*n,h=4*r,d=0;l>d;d=e){e=Math.min(l,d+h);for(var p=0;r>p;p++)for(var m=d+p;e>m;m+=r)if(i[m]&&0===(c[m]&u)){var g=16;if(0!==(c[m]&f)){c[m]^=f;var v=127&a[m];g=0===v?15:14}var y=t.readBit(o,g);i[m]=i[m]<<1|y,s[m]++,c[m]|=u}}},runCleanupPass:function(){for(var e,n=this.decoder,i=this.width,a=this.height,o=this.neighborsSignificance,s=this.coefficentsMagnitude,c=this.coefficentsSign,u=this.contexts,f=this.contextLabelTable,l=this.bitsDecoded,h=this.processingFlags,d=1,p=2,m=i,g=2*i,v=3*i,y=0;a>y;y=e){e=Math.min(y+4,a);for(var b=y*i,w=a>y+3,x=0;i>x;x++){var S,P=b+x,_=w&&0===h[P]&&0===h[P+m]&&0===h[P+g]&&0===h[P+v]&&0===o[P]&&0===o[P+m]&&0===o[P+g]&&0===o[P+v],I=0,k=P,C=y;if(_){var A=n.readBit(u,r);if(!A){l[P]++,l[P+m]++,l[P+g]++,l[P+v]++;continue}I=n.readBit(u,t)<<1|n.readBit(u,t),0!==I&&(C=y+I,k+=I*i),S=this.decodeSignBit(C,x,k),c[k]=S,s[k]=1,this.setNeighborsSignificance(C,x,k),h[k]|=p,k=P;for(var M=y;C>=M;M++,k+=i)l[k]++;I++}for(C=y+I;e>C;C++,k+=i)if(!s[k]&&0===(h[k]&d)){var D=f[o[k]],T=n.readBit(u,D);1===T&&(S=this.decodeSignBit(C,x,k),c[k]=S,s[k]=1,this.setNeighborsSignificance(C,x,k),h[k]|=p),l[k]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,r=this.contexts,n=e.readBit(r,t)<<3|e.readBit(r,t)<<2|e.readBit(r,t)<<1|e.readBit(r,t);if(10!==n)throw new Error("JPX Error: Invalid segmentation symbol")}},e}(),D=function(){function e(){}return e.prototype.calculate=function(e,t,r){for(var n=e[0],i=1,a=e.length;a>i;i++)n=this.iterate(n,e[i],t,r);return n},e.prototype.extend=function(e,t,r){var n=t-1,i=t+1,a=t+r-2,o=t+r;e[n--]=e[i++],e[o++]=e[a--],e[n--]=e[i++],e[o++]=e[a--],e[n--]=e[i++],e[o++]=e[a--],e[n]=e[i],e[o]=e[a]},e.prototype.iterate=function(e,t,r,n){var i,a,o,s,c,u,f=e.width,l=e.height,h=e.items,d=t.width,p=t.height,m=t.items;for(o=0,i=0;l>i;i++)for(s=2*i*d,a=0;f>a;a++,o++,s+=2)m[s]=h[o];h=e.items=null;var g=4,v=new Float32Array(d+2*g);if(1===d){if(0!==(1&r))for(u=0,o=0;p>u;u++,o+=d)m[o]*=.5}else for(u=0,o=0;p>u;u++,o+=d)v.set(m.subarray(o,o+d),g),this.extend(v,g,d),this.filter(v,g,d),m.set(v.subarray(g,g+d),o);var y=16,b=[];for(i=0;y>i;i++)b.push(new Float32Array(p+2*g));var w,x=0;if(e=g+p,1===p){if(0!==(1&n))for(c=0;d>c;c++)m[c]*=.5}else for(c=0;d>c;c++){if(0===x){for(y=Math.min(d-c,y),o=c,s=g;e>s;o+=d,s++)for(w=0;y>w;w++)b[w][s]=m[o+w];x=y}x--;var S=b[x];if(this.extend(S,g,p),this.filter(S,g,p),0===x)for(o=c-y+1,s=g;e>s;o+=d,s++)for(w=0;y>w;w++)m[o+w]=b[w][s]}return{width:d,height:p,items:m}},e}(),T=function(){function e(){D.call(this)}return e.prototype=Object.create(D.prototype),e.prototype.filter=function(e,t,r){var n=r>>1;t=0|t;var i,a,o,s,c=-1.586134342059924,u=-.052980118572961,f=.882911075530934,l=.443506852043971,h=1.230174104914001,d=1/h;for(i=t-3,a=n+4;a--;i+=2)e[i]*=d;for(i=t-2,o=l*e[i-1],a=n+3;a--&&(s=l*e[i+1],e[i]=h*e[i]-o-s,a--);i+=2)i+=2,o=l*e[i+1],e[i]=h*e[i]-o-s;for(i=t-1,o=f*e[i-1],a=n+2;a--&&(s=f*e[i+1],e[i]-=o+s,a--);i+=2)i+=2,o=f*e[i+1],e[i]-=o+s;for(i=t,o=u*e[i-1],a=n+1;a--&&(s=u*e[i+1],e[i]-=o+s,a--);i+=2)i+=2,o=u*e[i+1],e[i]-=o+s;if(0!==n)for(i=t+1,o=c*e[i-1],a=n;a--&&(s=c*e[i+1],e[i]-=o+s,a--);i+=2)i+=2,o=c*e[i+1],e[i]-=o+s},e}(),E=function(){function e(){D.call(this)}return e.prototype=Object.create(D.prototype),e.prototype.filter=function(e,t,r){var n=r>>1;t=0|t;var i,a;for(i=t,a=n+1;a--;i+=2)e[i]-=e[i-1]+e[i+1]+2>>2;for(i=t+1,a=n;a--;i+=2)e[i]+=e[i-1]+e[i+1]>>1},e}();return e}(),u=function(){function e(){}function o(e,t,r){this.data=e,this.start=t,this.end=r}function c(e,t,r){function n(e){for(var t=0,n=0;e>n;n++){var o=r.readBit(i,a);a=256>a?a<<1|o:511&(a<<1|o)|256,t=t<<1|o}return t>>>0}var i=e.getContexts(t),a=1,o=n(1),s=n(1)?n(1)?n(1)?n(1)?n(1)?n(32)+4436:n(12)+340:n(8)+84:n(6)+20:n(4)+4:n(2);return 0===o?s:s>0?-s:null}function u(e,t,r){for(var n=e.getContexts("IAID"),i=1,a=0;r>a;a++){var o=t.readBit(n,i);i=i<<1|o}return 31>r?i&(1<<r)-1:2147483647&i}function l(e,t,r){var n,i,a,o,s,c,u,f=r.decoder,l=r.contextCache.getContexts("GB"),h=[],d=31735;for(i=0;t>i;i++)for(s=h[i]=new Uint8Array(e),c=1>i?s:h[i-1],u=2>i?s:h[i-2],n=u[0]<<13|u[1]<<12|u[2]<<11|c[0]<<7|c[1]<<6|c[2]<<5|c[3]<<4,a=0;e>a;a++)s[a]=o=f.readBit(l,n),n=(n&d)<<1|(e>a+3?u[a+3]<<11:0)|(e>a+4?c[a+4]<<4:0)|o;return h}function h(e,t,r,n,i,a,o,s){if(e&&f("JBIG2 error: MMR encoding is not supported"),0===n&&!a&&!i&&4===o.length&&3===o[0].x&&-1===o[0].y&&-3===o[1].x&&-1===o[1].y&&2===o[2].x&&-2===o[2].y&&-2===o[3].x&&-2===o[3].y)return l(t,r,s);var c=!!a,u=I[n].concat(o);u.sort(function(e,t){return e.y-t.y||e.x-t.x});var h,d,p=u.length,m=new Int8Array(p),g=new Int8Array(p),v=[],y=0,b=0,w=0,x=0;for(d=0;p>d;d++)m[d]=u[d].x,g[d]=u[d].y,b=Math.min(b,u[d].x),w=Math.max(w,u[d].x),x=Math.min(x,u[d].y),p-1>d&&u[d].y===u[d+1].y&&u[d].x===u[d+1].x-1?y|=1<<p-1-d:v.push(d);var S=v.length,P=new Int8Array(S),_=new Int8Array(S),k=new Uint16Array(S);for(h=0;S>h;h++)d=v[h],P[h]=u[d].x,_[h]=u[d].y,k[h]=1<<p-1-d;for(var A,M,D,T,E,F=-b,R=-x,U=t-w,O=C[n],L=new Uint8Array(t),B=[],z=s.decoder,N=s.contextCache.getContexts("GB"),G=0,q=0,H=0;r>H;H++){if(i){var J=z.readBit(N,O);if(G^=J){B.push(L);continue}}for(L=new Uint8Array(L),B.push(L),A=0;t>A;A++)if(c&&a[H][A])L[A]=0;else{if(A>=F&&U>A&&H>=R)for(q=q<<1&y,d=0;S>d;d++)M=H+_[d],D=A+P[d],T=B[M][D],T&&(T=k[d],q|=T);else for(q=0,E=p-1,d=0;p>d;d++,E--)D=A+m[d],D>=0&&t>D&&(M=H+g[d],M>=0&&(T=B[M][D],T&&(q|=T<<E)));var X=z.readBit(N,q);L[A]=X}}return B}function d(e,t,r,n,i,a,o,s,c){var u=k[r].coding;0===r&&(u=u.concat([s[0]]));var l,h=u.length,d=new Int32Array(h),p=new Int32Array(h);for(l=0;h>l;l++)d[l]=u[l].x,p[l]=u[l].y;var m=k[r].reference;0===r&&(m=m.concat([s[1]]));var g=m.length,v=new Int32Array(g),y=new Int32Array(g);for(l=0;g>l;l++)v[l]=m[l].x,y[l]=m[l].y;for(var b=n[0].length,w=n.length,x=A[r],S=[],P=c.decoder,_=c.contextCache.getContexts("GR"),I=0,C=0;t>C;C++){if(o){var M=P.readBit(_,x);I^=M,I&&f("JBIG2 error: prediction is not supported")}var D=new Uint8Array(e);S.push(D);for(var T=0;e>T;T++){var E,F,R=0;for(l=0;h>l;l++)E=C+p[l],F=T+d[l],0>E||0>F||F>=e?R<<=1:R=R<<1|S[E][F];for(l=0;g>l;l++)E=C+y[l]+a,F=T+v[l]+i,0>E||E>=w||0>F||F>=b?R<<=1:R=R<<1|n[E][F];var U=P.readBit(_,R);D[T]=U}}return S}function p(e,r,n,i,a,o,s,l,p,g,v){e&&f("JBIG2 error: huffman is not supported");for(var y=[],b=0,w=t(n.length+i),x=v.decoder,S=v.contextCache;y.length<i;){var P=c(S,"IADH",x);b+=P;for(var _=0,I=0;;){var k=c(S,"IADW",x);if(null===k)break;_+=k,I+=_;var C;if(r){var A=c(S,"IAAI",x);if(A>1)C=m(e,r,_,b,0,A,1,n.concat(y),w,0,0,1,0,o,p,g,v);else{var M=u(S,x,w),D=c(S,"IARDX",x),T=c(S,"IARDY",x),E=M<n.length?n[M]:y[M-n.length];C=d(_,b,p,E,D,T,!1,g,v)}}else C=h(!1,_,b,s,!1,null,l,v);y.push(C)}}for(var F=[],R=[],U=!1,O=n.length+i;R.length<O;){for(var L=c(S,"IAEX",x);L--;)R.push(U);U=!U}for(var B=0,z=n.length;z>B;B++)R[B]&&F.push(n[B]);for(var N=0;i>N;B++,N++)R[B]&&F.push(y[N]);return F}function m(e,t,r,n,i,a,o,s,l,h,p,m,g,v,y,b,w){e&&f("JBIG2 error: huffman is not supported");var x,S,P=[];for(x=0;n>x;x++){if(S=new Uint8Array(r),i)for(var _=0;r>_;_++)S[_]=i;P.push(S)}var I=w.decoder,k=w.contextCache,C=-c(k,"IADT",I),A=0;for(x=0;a>x;){var M=c(k,"IADT",I);C+=M;var D=c(k,"IAFS",I);A+=D;for(var T=A;;){var E=1===o?0:c(k,"IAIT",I),F=o*C+E,R=u(k,I,l),U=t&&c(k,"IARI",I),O=s[R],L=O[0].length,B=O.length;if(U){var z=c(k,"IARDW",I),N=c(k,"IARDH",I),G=c(k,"IARDX",I),q=c(k,"IARDY",I);L+=z,B+=N,O=d(L,B,y,O,(z>>1)+G,(N>>1)+q,!1,b,w)}var H,J,X,V=F-(1&m?0:B),j=T-(2&m?L:0);if(h){for(H=0;B>H;H++)if(S=P[j+H]){X=O[H];var Y=Math.min(r-V,L);switch(g){case 0:for(J=0;Y>J;J++)S[V+J]|=X[J];break;case 2:for(J=0;Y>J;J++)S[V+J]^=X[J];break;default:f("JBIG2 error: operator "+g+" is not supported")}}T+=B-1}else{for(J=0;B>J;J++)if(S=P[V+J])switch(X=O[J],g){case 0:for(H=0;L>H;H++)S[j+H]|=X[H];break;case 2:for(H=0;L>H;H++)S[j+H]^=X[H];break;default:f("JBIG2 error: operator "+g+" is not supported")}T+=L-1}x++;var W=c(k,"IADS",I);if(null===W)break;T+=W+p}}return P}function g(e,t){var r={};r.number=i(e,t);var a=e[t+4],o=63&a;_[o]||f("JBIG2 error: invalid segment type: "+o),r.type=o,r.typeName=_[o],r.deferredNonRetain=!!(128&a);var s=!!(64&a),c=e[t+5],u=c>>5&7,l=[31&c],h=t+6;if(7===c){u=536870911&i(e,h-1),h+=3;var d=u+7>>3;for(l[0]=e[h++];--d>0;)l.push(e[h++])}else(5===c||6===c)&&f("JBIG2 error: invalid referred-to flags");r.retainBits=l;var p,m,g=r.number<=256?1:r.number<=65536?2:4,v=[];for(p=0;u>p;p++){var b=1===g?e[h]:2===g?n(e,h):i(e,h);v.push(b),h+=g}if(r.referredTo=v,s?(r.pageAssociation=i(e,h),h+=4):r.pageAssociation=e[h++],r.length=i(e,h),h+=4,4294967295===r.length)if(38===o){var w=y(e,h),x=e[h+M],S=!!(1&x),P=6,I=new Uint8Array(P);for(S||(I[0]=255,I[1]=172),I[2]=w.height>>>24&255,I[3]=w.height>>16&255,I[4]=w.height>>8&255,I[5]=255&w.height,p=h,m=e.length;m>p;p++){for(var k=0;P>k&&I[k]===e[p+k];)k++;if(k===P){r.length=p+P;break}}4294967295===r.length&&f("JBIG2 error: segment end was not found")}else f("JBIG2 error: invalid unknown segment length");return r.headerEnd=h,r}function v(e,t,r,n){for(var i=[],a=r;n>a;){var o=g(t,a);a=o.headerEnd;var s={header:o,data:t};if(e.randomAccess||(s.start=a,a+=o.length,s.end=a),i.push(s),51===o.type)break}if(e.randomAccess)for(var c=0,u=i.length;u>c;c++)i[c].start=a,a+=i[c].header.length,i[c].end=a;return i}function y(e,t){return{width:i(e,t),height:i(e,t+4),x:i(e,t+8),y:i(e,t+12),combinationOperator:7&e[t+16]}}function b(e,t){var a,o,s,c,u=e.header,l=e.data,h=e.start,d=e.end;switch(u.type){case 0:var p={},m=n(l,h);if(p.huffman=!!(1&m),p.refinement=!!(2&m),p.huffmanDHSelector=m>>2&3,p.huffmanDWSelector=m>>4&3,p.bitmapSizeSelector=m>>6&1,p.aggregationInstancesSelector=m>>7&1,p.bitmapCodingContextUsed=!!(256&m),p.bitmapCodingContextRetained=!!(512&m),p.template=m>>10&3,p.refinementTemplate=m>>12&1,h+=2,!p.huffman){for(c=0===p.template?4:1,o=[],s=0;c>s;s++)o.push({x:r(l,h),y:r(l,h+1)}),h+=2;p.at=o}if(p.refinement&&!p.refinementTemplate){for(o=[],s=0;2>s;s++)o.push({x:r(l,h),y:r(l,h+1)}),h+=2;p.refinementAt=o}p.numberOfExportedSymbols=i(l,h),h+=4,p.numberOfNewSymbols=i(l,h),h+=4,a=[p,u.number,u.referredTo,l,h,d];break;case 6:case 7:var g={};g.info=y(l,h),h+=M;var v=n(l,h);if(h+=2,g.huffman=!!(1&v),g.refinement=!!(2&v),g.stripSize=1<<(v>>2&3),g.referenceCorner=v>>4&3,g.transposed=!!(64&v),g.combinationOperator=v>>7&3,g.defaultPixelValue=v>>9&1,g.dsOffset=v<<17>>27,g.refinementTemplate=v>>15&1,g.huffman){var b=n(l,h);h+=2,g.huffmanFS=3&b,g.huffmanDS=b>>2&3,g.huffmanDT=b>>4&3,g.huffmanRefinementDW=b>>6&3,g.huffmanRefinementDH=b>>8&3,g.huffmanRefinementDX=b>>10&3,g.huffmanRefinementDY=b>>12&3,g.huffmanRefinementSizeSelector=!!(14&b)}if(g.refinement&&!g.refinementTemplate){for(o=[],s=0;2>s;s++)o.push({x:r(l,h),y:r(l,h+1)}),h+=2;g.refinementAt=o}g.numberOfSymbolInstances=i(l,h),h+=4,g.huffman&&f("JBIG2 error: huffman is not supported"),a=[g,u.referredTo,l,h,d];break;case 38:case 39:var w={};w.info=y(l,h),h+=M;var x=l[h++];if(w.mmr=!!(1&x),w.template=x>>1&3,w.prediction=!!(8&x),!w.mmr){for(c=0===w.template?4:1,o=[],s=0;c>s;s++)o.push({x:r(l,h),y:r(l,h+1)}),h+=2;w.at=o}a=[w,l,h,d];break;case 48:var S={width:i(l,h),height:i(l,h+4),resolutionX:i(l,h+8),resolutionY:i(l,h+12)};4294967295===S.height&&delete S.height;{var P=l[h+16];n(l,h+17)}S.lossless=!!(1&P),S.refinement=!!(2&P),S.defaultPixelValue=P>>2&1,S.combinationOperator=P>>3&3,S.requiresBuffer=!!(32&P),S.combinationOperatorOverride=!!(64&P),a=[S];break;case 49:break;case 50:break;case 51:break;case 62:break;default:f("JBIG2 error: segment type "+u.typeName+"("+u.type+") is not implemented")}var _="on"+u.typeName;_ in t&&t[_].apply(t,a)}function w(e,t){for(var r=0,n=e.length;n>r;r++)b(e[r],t)}function x(e){for(var t=new S,r=0,n=e.length;n>r;r++){var i=e[r],a=v({},i.data,i.start,i.end);w(a,t)}return t}function S(){}function P(){}e.prototype={getContexts:function(e){return e in this?this[e]:this[e]=new Int8Array(65536)}},o.prototype={get decoder(){var e=new s(this.data,this.start,this.end);return a(this,"decoder",e)},get contextCache(){var t=new e;return a(this,"contextCache",t)}};var _=["SymbolDictionary",null,null,null,"IntermediateTextRegion",null,"ImmediateTextRegion","ImmediateLosslessTextRegion",null,null,null,null,null,null,null,null,"patternDictionary",null,null,null,"IntermediateHalftoneRegion",null,"ImmediateHalftoneRegion","ImmediateLosslessHalftoneRegion",null,null,null,null,null,null,null,null,null,null,null,null,"IntermediateGenericRegion",null,"ImmediateGenericRegion","ImmediateLosslessGenericRegion","IntermediateGenericRefinementRegion",null,"ImmediateGenericRefinementRegion","ImmediateLosslessGenericRefinementRegion",null,null,null,null,"PageInformation","EndOfPage","EndOfStripe","EndOfFile","Profiles","Tables",null,null,null,null,null,null,null,null,"Extension"],I=[[{x:-1,y:-2},{x:0,y:-2},{x:1,y:-2},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:2,y:-1},{x:-4,y:0},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0}],[{x:-1,y:-2},{x:0,y:-2},{x:1,y:-2},{x:2,y:-2},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:2,y:-1},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0}],[{x:-1,y:-2},{x:0,y:-2},{x:1,y:-2},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-2,y:0},{x:-1,y:0}],[{x:-3,y:-1},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-4,y:0},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0}]],k=[{coding:[{x:0,y:-1},{x:1,y:-1},{x:-1,y:0}],reference:[{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}]},{coding:[{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0}],reference:[{x:0,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]}],C=[39717,1941,229,405],A=[32,8],M=17;return S.prototype={onPageInformation:function(e){this.currentPageInfo=e;var t=e.width+7>>3,r=new Uint8Array(t*e.height);if(e.defaultPixelValue)for(var n=0,i=r.length;i>n;n++)r[n]=255;this.buffer=r},drawBitmap:function(e,t){var r,n,i,a,o=this.currentPageInfo,s=e.width,c=e.height,u=o.width+7>>3,l=o.combinationOperatorOverride?e.combinationOperator:o.combinationOperator,h=this.buffer,d=128>>(7&e.x),p=e.y*u+(e.x>>3);switch(l){case 0:for(r=0;c>r;r++){for(i=d,a=p,n=0;s>n;n++)t[r][n]&&(h[a]|=i),i>>=1,i||(i=128,a++);p+=u}break;case 2:for(r=0;c>r;r++){for(i=d,a=p,n=0;s>n;n++)t[r][n]&&(h[a]^=i),i>>=1,i||(i=128,a++);p+=u}break;default:f("JBIG2 error: operator "+l+" is not supported")}},onImmediateGenericRegion:function(e,t,r,n){var i=e.info,a=new o(t,r,n),s=h(e.mmr,i.width,i.height,e.template,e.prediction,null,e.at,a);this.drawBitmap(i,s)},onImmediateLosslessGenericRegion:function(){this.onImmediateGenericRegion.apply(this,arguments)},onSymbolDictionary:function(e,t,r,n,i,a){var s;e.huffman&&f("JBIG2 error: huffman is not supported");var c=this.symbols;c||(this.symbols=c={});for(var u=[],l=0,h=r.length;h>l;l++)u=u.concat(c[r[l]]);var d=new o(n,i,a);c[t]=p(e.huffman,e.refinement,u,e.numberOfNewSymbols,e.numberOfExportedSymbols,s,e.template,e.at,e.refinementTemplate,e.refinementAt,d)},onImmediateTextRegion:function(e,r,n,i,a){for(var s,c=e.info,u=this.symbols,f=[],l=0,h=r.length;h>l;l++)f=f.concat(u[r[l]]);var d=t(f.length),p=new o(n,i,a),g=m(e.huffman,e.refinement,c.width,c.height,e.defaultPixelValue,e.numberOfSymbolInstances,e.stripSize,f,d,e.transposed,e.dsOffset,e.referenceCorner,e.combinationOperator,s,e.refinementTemplate,e.refinementAt,p);this.drawBitmap(c,g)},onImmediateLosslessTextRegion:function(){this.onImmediateTextRegion.apply(this,arguments)}},P.prototype={parseChunks:function(e){return x(e)}},P}(),f=function(){throw console.error.apply(console,arguments),new Error("PDFJS error: "+arguments[0])},l=function(){console.warn.apply(console,arguments)},h=function(){console.info.apply(console,arguments)};u.prototype.parse=function(e){var t=0,r=e.length;(151!==e[t]||74!==e[t+1]||66!==e[t+2]||50!==e[t+3]||13!==e[t+4]||10!==e[t+5]||26!==e[t+6]||10!==e[t+7])&&f("JBIG2 error: invalid header");var n={};t+=8;var a=e[t++];n.randomAccess=!(1&a),2&a||(n.numberOfPages=i(e,t),t+=4);for(var o=this.parseChunks([{data:e,start:t,end:r}]),s=o.currentPageInfo.width,c=o.currentPageInfo.height,u=o.buffer,e=new Uint8Array(s*c),l=0,h=0,d=0;c>d;d++)for(var p,m=0,g=0;s>g;g++)m||(m=128,p=u[h++]),e[l++]=p&m?0:255,m>>=1;this.width=s,this.height=c,this.data=e},e.JpegImage=o,e.JpxImage=c,e.Jbig2Image=u}(i||(i={}));var a=i.JpegImage,o=i.JpxImage,s=i.Jbig2Image},{}],5:[function(e,t){"use strict";t.exports=function(t){var r=e("./decode");t.onmessage=function(e){var n=e.data;r(n.buf,{},function(e,r){if(e){var n=e instanceof Error?e.message:e;t.postMessage({err:n})}else t.postMessage({result:r})})}}},{"./decode":6}],6:[function(e,t){"use strict";function r(e,t,r){function i(e,t,r){var n={width:t,height:r,data:new Uint8Array(t*r*4)};return e.copyToImageData(n),n.data}try{var a=new n;a.parse(e);var o=t.width||a.width,s=t.height||a.height,c=i(a,o,s),u={width:o,height:s,data:c};r(null,u)}catch(f){"string"==typeof f&&(f=new Error(f)),r(f)}}var n=e("./3rd-party/jpg").JpegImage;t.exports=r},{"./3rd-party/jpg":4}],7:[function(e,t){"use strict";t.exports=function(t){var r=e("./encode");t.onmessage=function(e){r(e.data,e.options,function(e,r){e?t.postMessage({err:e}):t.postMessage({output:r},[r.data])})}}},{"./encode":8}],8:[function(e,t){"use strict";function r(e,t,r){try{var i={data:e,width:t.width,height:t.height},a=n(i,t.quality);r(null,a)}catch(o){r(o)}}var n=e("./3rd-party/encoder");t.exports=r},{"./3rd-party/encoder":3}],9:[function(e,t){"use strict";t.exports=function(t){var r=e("./exif");t.onmessage=function(e){var n=e.data;r(n.buf,{},function(e,r){if(e){var n=e instanceof Error?e.message:e;t.postMessage({err:n})}else t.postMessage({result:r})})}}},{"./exif":10}],10:[function(e,t){"use strict";function r(e,t,r){try{var i=new n;i.load(e),t.hasOwnProperty("hasMakerNote")&&t.hasMakerNote||i.deleteTag("MakerNote");var a=i.getAllTags();r(null,a)}catch(o){r(o)}}var n=e("./3rd-party/ExifReader").ExifReader;t.exports=r},{"./3rd-party/ExifReader":2}],11:[function(e,t){"use strict";var r="undefined"!=typeof window&&"Worker"in window;if(r)try{var n=e("webworkify")(function(){});n.terminate()}catch(i){r=!1}t.exports.HAS_WORKER=r},{webworkify:12}],12:[function(e,t){var r=arguments[3],n=arguments[4],i=arguments[5],a=JSON.stringify;t.exports=function(e){for(var t,o=Object.keys(i),s=0,c=o.length;c>s;s++){var u=o[s];if(i[u].exports===e){t=u;break}}if(!t){t=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},s=0,c=o.length;c>s;s++){var u=o[s];f[u]=u}n[t]=[Function(["require","module","exports"],"("+e+")(self)"),f]}var l=Math.floor(Math.pow(16,8)*Math.random()).toString(16),h={};h[t]=t,n[l]=[Function(["require"],"require("+a(t)+")(self)"),h];var d="("+r+")({"+Object.keys(n).map(function(e){return a(e)+":["+n[e][0]+","+a(n[e][1])+"]"}).join(",")+"},{},["+a(l)+"])",p=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(p.createObjectURL(new Blob([d],{type:"text/javascript"})))}},{}]},{},[1])(1)});